#!/bin/bash
#
. i_config

# Funcionalidad no implementada
#==> * Hacer un dump parseado de variables generales

##***********************************************************************************************##
## HOLA!
##***********************************************************************************************##

if [ "$1" = "hola" ]
then

	echo " objetivo: Brindar informacion sobre el entorno."

##***********************************************************************************************##
##	*LOGO*
##***********************************************************************************************##
#@ entorno logo                                -- Muestra el logo de APEX
elif [ "$1" = "logo" ] 
then                    

	echo ""
	echo " **********************************************************" 
	echo " *                                                        *" 
	echo " *                  SSSSS   II   UU  UU                   *"
	echo " *                 SS       II   UU  UU                   *"
	echo " *                 SSSSSS   II   UU  UU                   *"
	echo " *                     SS   II   UU  UU                   *"
	echo " *                 SSSSS    II    UUUU                    *"
	echo " *                                                        *" 
	echo " *                                                        *" 
	echo " *   TTTTTTTTTT    OOOOOOOO    BBBBBBBB        AAAA       *"
	echo " *   TTTTTTTTTT   OOOOOOOOOO   BBBBBBBBB     AAAAAAAA     *"
	echo " *       TT       OO      OO   BB      BB   AA      AA    *"
	echo " *       TT       OO      OO   BB      BB   AA      AA    *"
	echo " *       TT       OO      OO   BB      B    AA      AA    *"
	echo " *       TT       OO      OO   BBBBBBBBB    AAAAAAAAAA    *"
	echo " *       TT       OO      OO   BB      B    AAAAAAAAAA    *"
	echo " *       TT       OO      OO   BB      BB   AA      AA    *"
	echo " *       TT       OO      OO   BB      BB   AA      AA    *"
	echo " *       TT       OOOOOOOOOO   BBBBBBBBB    AA      AA    *"
	echo " *       TT        OOOOOOOO    BBBBBBBB     AA      AA    *"
	echo " *                                                        *" 
	echo " *                                                        *" 
	echo " *            --  Ambiente Php EXtensible --              *"
	echo " *                                                        *" 
	echo " **********************************************************" 
	echo ""
                                 
##***********************************************************************************************##
## Lista los scripts existentes
##***********************************************************************************************##
#@ entorno i                                   -- Lista las instancias

elif [ "$1" = "i" ]
then

	php $d_bin/php/instancias.php $toba_dir -i

##***********************************************************************************************##
## Lista los scripts existentes
##***********************************************************************************************##
#@ entorno listar_scripts                      -- Lista los scripts existentes

elif [ "$1" = "listar_scripts" ]
then

	ls -1 $d_bin | egrep -v "^d|i_|3_" | awk '{ print $1 }' | egrep -v "^$" | sort

##***********************************************************************************************##
## Introduce los scripts existentes
##***********************************************************************************************##
#@ entorno scripts                             -- Introduccion a los scripts existentes

elif [ "$1" = "scripts" ]
then

	echo
	echo " --- SCRIPTS ---"
	echo
	for a in `entorno listar_scripts`
	do
		echo " * $a" `$a hola | sed 's/objetivo//'`
	done

##***********************************************************************************************##
## Muestra el manual de los scripts existentes
##***********************************************************************************************##
#@ entorno inf                                 -- Muestra la informacion sobre el entorno

elif [ "$1" = "inf" ]
then

	echo
	entorno logo
	echo "Lista de SCRIPTS disponibles ($e_dia - $e_hora)"
	for i in `entorno listar_scripts`
	do
		echo 
		echo "********************************************************************************" 
		echo "***  $i  *********************************************************************" 
		echo "********************************************************************************" 
		$i	
		$i pendiente 
		echo 
	done	
	echo "********************************************************************************"

##***********************************************************************************************##
##	cat $d_raiz/notas.txt## Muestra NOTAS sobbre el entorno
##***********************************************************************************************##
#@ entorno notas                               -- Muestra NOTAS sobbre el entorno

elif [ "$1" = "notas" ]
then

	cat $d_entrada/notas.txt

##***********************************************************************************************##
## Muestra el historico de comandos
##***********************************************************************************************##
#@ entorno his                                 -- Muestra el historico de comandos

elif [ "$1" = "his" ]
then

	echo
	cat $d_salida/historico_comandos.txt
	echo
	
##***********************************************************************************************##
## Resetea el historico de comandos
##***********************************************************************************************##
#@ entorno reset_his                           -- Resetea el historico de comandos

elif [ "$1" = "reset_his" ]
then
	
	echo "$e_dia $e_hora -- RESET!"	> $d_salida/historico_comandos.txt

##***********************************************************************************************##
## Muesta las variables globales
##***********************************************************************************************##
#@ entorno vars                                -- Muesta las variables globales

elif [ "$1" = "vars" ]
then

	dump_vars

##***********************************************************************************************##
## Cambia el archivo de Instancias
##***********************************************************************************************##
#@ entorno ci                                  -- Swapea el archivo de configuracion de instancias

elif [ "$1" = "ci" ]
then

	if [ -z "$2" ]
	then
		echo "Especificar ID del fuente"
	else
		archivo_origen=${d_php}/instancias_${2}.php
		if [ -e $archivo_origen ]
		then
			cp $archivo_origen $archivo_instancias
		else
			echo "No existe el archivo \"$archivo_origen\""
		fi
	fi

##***********************************************************************************************##
## Genera el script de configuracionde apache
##***********************************************************************************************##
#@ entorno apache                              -- Genera el archivo de APACHE

elif [ "$1" = "apache" ]
then

	echo "###############################################"
	echo "##"
	echo "## Configuracion APACHE del SIU TOBA          #"
	echo "##"
	echo "##"
	echo "##########  Alias principal  ##################"
	echo "##"
	sed "s/%toba_dir%/$toba_dir/g" $d_entrada/toba.conf
	echo "##"
	echo "##########  Proyectos        ##################"
	echo "##"
	cat $toba_dir/proyectos/*/toba.conf						
	echo "##"
	echo "###############################################"


##***********************************************************************************************##
## Muesta las variables globales
##***********************************************************************************************##
#@ entorno full                                -- Muesta el estado general del entorno

elif [ "$1" = "full" ]
then

	echo
	echo "###########################################################################"
	echo "########################   Variables de entorno   #########################"
	echo "###########################################################################"
	echo
	echo " toba_dir: " $toba_dir
	echo " toba_instancia: " $toba_instancia
	echo
	echo "###########################################################################"
	echo "##########################   Variables internas   #########################"
	echo "###########################################################################"
	dump_vars
	echo
	echo "###########################################################################"
	echo "############################   Instancias <I>   ###########################"
	echo "###########################################################################"
	echo
	cat $archivo_instancias
		
##***********************************************************************************************##
## Muesta las variables globales
##***********************************************************************************************##
#@ entorno func                                -- Muesta las funciones disponibles

elif [ "$1" = "func" ]
then
	
	echo
	echo "Funciones disponibles"
	echo
	fgrep "#@" $d_bin/i_func | egrep -v "fgrep" |  sed 's/#@//'

##***********************************************************************************************##
## Ver Cosas Pendientes
##***********************************************************************************************##
elif [ "$1" = "pendiente" ]
then
	pendiente $0

##***********************************************************************************************##
## Ayuda
##***********************************************************************************************##
else
	ayuda $0
fi
