#!/bin/bash
#
. i_func 		# Incluyo la funcionalidad standart

##***********************************************************************************************##
## 1) Inicializo variables generales
##***********************************************************************************************##

#-------------------------------------------------------------------------
#------- Directorios  ----------------------------------------------------
#-------------------------------------------------------------------------

d_bin=$toba_dir/bin					# carpeta donde estan los SCRIPTs BASH y PHP de linea de comandos
d_salida=$d_bin/salida				# carpeta donde se guarda la salida de los scripts
d_entrada=$d_bin/entrada				# carpeta donde se guarda la entrada de los scripts
d_awk=$d_entrada/awk					# carpeta donde se guardan los scrips AWK
d_sql=$toba_dir/sql					# carpeta donde estan los SCRIPTs SQL
d_var=$toba_dir/var					# carpeta donde se graba informacion circustancial
d_proy=$toba_dir/proyectos			# carpeta donde se guardan los proyectos
d_doc=$toba_dir/doc					# carpeta donde se guardan la documentacion
d_php=$toba_dir/php					# carpeta donde se guardan los scrips PHP

#-------------------------------------------------------------------------
#------- PostgreSQL ------------------------------------------------------
#-------------------------------------------------------------------------

# Si el primer parametro de un script es el NOMBRE de una instancia conocida
# seteo esa instancia como la instancia que hay que utilizar,
# sino utilizo la instancia por defecto

#--[ 1 ]-- Selecciono la instancia

instancia=$toba_instancia							#	 Instancia por defecto
case "$1" in
desarrollo)		instancia=desarrollo;
					shift;;
prueba)			instancia=prueba;
					shift;;
produccion)		instancia=produccion;
					shift;;
toba_costos)	instancia=toba_costos;
					shift;;
toba_agentes)	instancia=toba_agentes;
					shift;;
esac

#--[ 2 ]-- Busco los parametros de esa instancia

	archivo_instancias=$d_php/instancias.php # Saco los datos del archivo de configuracion de PHP

	db_motor=`awk -F\" '/'$instancia'.*motor/ { print $4 }' $archivo_instancias`
	db_host=`awk -F\" '/'$instancia'.*profile/ { print $4 }' $archivo_instancias`
	db_usuario=`awk -F\" '/'$instancia'.*usuario/ { print $4 }' $archivo_instancias`
	db_clave=`awk -F\" '/'$instancia'.*clave/ { print $4 }' $archivo_instancias`
	db_base=`awk -F\" '/'$instancia'.*base/ { print $4 }' $archivo_instancias`
	db_puerto=5432
	db_string=" -U $db_usuario -h $db_host -p $db_puerto -d $db_base"
#	db_string=" -U $db_usuario -d $db_base"
	
#-------------------------------------------------------------------------
#------ General  ---------------------------------------------------------
#-------------------------------------------------------------------------

#-- Variables genericas
e_dia=`date +%Y-%m-%d`										# DIA
e_hora=`date +%H_%M_%S`										# HORA
e_serial=`date +%s`											# STRING unico (para cosas temporales)
e_prompt="toba>"												# PROMPT

#-- nomenclatura de archivos SQL
s_sql_ini="pgsql_"											# Prefijo del los archivos SQL
s_sql_fin="*.sql"												# Sufijo de los archivos SQL
s_sql_datos=${s_sql_ini}datos_${instancia}.sql		# Achivo de datos ACTUAL
c_auto="_auto"													# Carpeta donde se guarda la informacion automatica

##***********************************************************************************************##
## 2) Guardo el acceso SCRIPT
##***********************************************************************************************##

echo "$e_dia $e_hora -- $0 -- $*"	>> $d_salida/historico_comandos.txt

##***********************************************************************************************##
##***********************************************************************************************##
