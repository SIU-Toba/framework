#!/bin/bash
#
# Funciones!

# Funcionalidad no implementada
#==> * Se deberia especificar si la consulta es V/H
#==> * Funcion para imprimir titulares, etc (paquete grafico).

##***********************************************************************************************##
#@ sa_()                 - Imprime los parametros con el prompt de la aplicacion
##***********************************************************************************************##

sa_()
{
	echo "$e_prompt $*" 1>&2
}

##***********************************************************************************************##
#@ sq_()                - Imprime los parametros como una pregunta
##***********************************************************************************************##

sp_()
{
	echo -n "$e_prompt $* ?(S):"
}

##***********************************************************************************************##
#@ pgsql_consultar()    - Ejecuta una consulta sobre el motor utilizando el cliente 'psql'
##***********************************************************************************************##

# 1: STRING SQL
# 2: --html

pgsql_consultar ()
{
	local html=""
	if [ "$2" == "--html" ]
	then
		html=" -H "
	fi
	psql -P border=2 $db_string $html -c "$1"
}

##***********************************************************************************************##
#@ pgsql_ejecutar()     - Ejecuta un script SQL utilizando 'psql'.
#@                        Pueden utilizarse los modificadores --debug o --noparar.
##***********************************************************************************************##

# 1: Archivo
# 2, 3: --debug, --noparar

pgsql_ejecutar ()
{
	local debug=""
	local parar=" -v ON_ERROR_STOP= "
	if [ "$2" == "--debug" ] || [ "$3" == "--debug" ]
	then
		debug=" -a "
	fi
	if [ "$2" == "--noparar" ] || [ "$3" == "--noparar" ]
	then
		parar=""
	fi
	psql -f $1 $db_string $debug $parar
}

##***********************************************************************************************##
#@ controlar()          - Chequea el codigo de retorno del comando anterior y lo informa.
#@                        Si es != 0 corta la ejecucion.
##***********************************************************************************************##

controlar ()
{
	if [ $? = 0 ]
	then
		sa_ "- ********************> OK - $1"
	else
		sa_ "- ????????????????????> ERROR $? - $1"
		echo "$e_dia $e_hora -- ERROR!"	>> $d_salida/historico_comandos.txt
		exit 1
	fi
}

##***********************************************************************************************##
#@ ayuda()              - Genera AYUDA sobre comandos.
##***********************************************************************************************##

ayuda ()
{
	echo
	$0 hola
	echo
	echo " Modo de Uso:"
	echo " ------------"
	echo
	fgrep "#@" $0 |  sed 's/#@//' | egrep -v "grep"
	echo
}

##***********************************************************************************************##
#@ pendiente()          - Muestra los items pendientes del SCRIPT
##***********************************************************************************************##

pendiente ()
{
	echo
	echo " Funcionalidad pendiente:"
	echo " ------------------------"
	echo
	fgrep "#==>" $0 |  sed 's/#==>//' | egrep -v "grep"
	echo
}

##***********************************************************************************************##
#@ entorno()            - Muestra las variables de entorno
##***********************************************************************************************##

dump_vars ()
{
	echo
	echo "-------- POSTGRESQL -----------"
	echo
	echo "instancia: " $instancia
	echo "db_motor: " $db_motor
	echo "db_host: " $db_host
	echo "db_usuario: " $db_usuario
	echo "db_clave: " $db_clave
	echo "db_base: " $db_base
	echo "db_puerto: " $db_puerto
	echo "db_string: " $db_string
	echo
	echo "-------- GENERICAS -----------"
	echo
	echo "DIA: " $e_dia
	echo "HORA: " $e_hora
	echo "SERIAL: " $e_serial
}

##***********************************************************************************************##
##***********************************************************************************************##
