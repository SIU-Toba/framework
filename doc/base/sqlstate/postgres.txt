Cosas sobre el manejo del SQLSTATE en POSRGRESQL


Not the driver's fault, the backend doesn't implement error codes. You
should customize the error messages based on the exception's
getMessage().

ERROR CODES

All messages emitted by the PostgreSQL server are assigned five-character error codes that follow the SQL standard's conventions for "SQLSTATE" codes. Applications that need to know which error condition has occurred should usually test the error code, rather than looking at the textual error message. The error codes are less likely to change across PostgreSQL releases, and also are not subject to change due to localization of error messages. 
According to the standard, the first two characters of an error code denote a class of errors, while the last three characters indicate a specific condition within that class. Thus, an application that does not recognize the specific error code may still be able to infer what to do from the error class. 

<?
echo "Existe la funcion que devuelve el SQLSTATE (pg_result_error_field)? ";
if(function_exists("pg_result_error_field"))
{
	echo "SI.";
}else{
	echo "NO.";
}
?>

<?php
  if(!($db = pg_connect("user=foo password=bar dbname=foobar")))
   die("pg_connect");

  if(!pg_send_query($db, "SELECT foo FROM bar"))
   die("pg_send_query");

  if(!($result = pg_get_result($db)))
   die("pg_get_result");

  echo(pg_result_error($result) . "<br />\n");

  /* only available if you have patched php */
  if(function_exists("pg_result_error_field"))
  {
   $fieldcode = array(
     "PGSQL_DIAG_SEVERITY",        "PGSQL_DIAG_SQLSTATE",
     "PGSQL_DIAG_MESSAGE_PRIMARY", "PGSQL_DIAG_MESSAGE_DETAIL",
     "PGSQL_DIAG_MESSAGE_HINT",    "PGSQL_DIAG_STATEMENT_POSITION",
     "PGSQL_DIAG_CONTEXT",        "PGSQL_DIAG_SOURCE_FILE",
     "PGSQL_DIAG_SOURCE_LINE",    "PGSQL_DIAG_SOURCE_FUNCTION");

   foreach($fieldcode as $fcode)
   {
     printf("%s: %s<br />\n",
       $fcode,
       pg_result_error_field($result, constant($fcode)));
   }

   pg_free_result($result);
  }
?>

<?php pg_result_error_field($result, PGSQL_DIAG_SQLSTATE); ?>