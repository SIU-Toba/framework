<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
 <title>Referencia/Deployment - SIU-Toba - Trac</title><link rel="start" href="../../wiki.html" /><link rel="search" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/search" /><link rel="help" href="../TracGuide.html" /><link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="icon" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/favicon.ico" type="image/x-icon" /><link rel="alternate" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/wiki/Referencia/Deployment?format=txt" title="Plain Text" type="text/x-trac-wiki" /><style type="text/css">
.wikipage h2 {border-bottom: 1px solid gray;}

/* trac php syntax highlighting */
.code-block {
    line-height: 1em;
    font-family: Courier, monotype;
    font-size: 12px;
    }
.h_question { color: #0000BB; } /* highlight.default */
.hphp_commentline { color: #FF8000; } /* highlight.comment */
.hphp_operator { color: #007700; } /* highlight.keyword */
.hphp_word { color: #007700; } /* highlight.keyword */
.hphp_default {}
.hphp_variable { color: #0000BB; } /* highlight.default */
.hphp_hstring { color: #DD0000; } /* highlight.string */
.hphp_simplestring { color: #DD0000; } /* highlight.string */
.h_tagunknown {}
.h_default {}

.code-keyword { color: #007700; font-weight: normal; }
.code-lang { color: #0000BB; font-weight: normal; }
.code-comment { color: #FF8000; font-weight: normal;}
.code-string { color: #DD0000; font-weight: normal;}

pre { padding:0; margin: 0}

.tablas-screenshots td:first-child { background-color: #D5CECD; width: 30%}
.tablas-screenshots table { width: 90%; border: 1px solid gray; }
.tablas-screenshots td { }
.tablas-screenshots table.wiki td { border: 1px solid gray; }

#tkt-changes-hdr {
    clear: both;
    padding-top: 30px;
}
.wiki-toc {
    clear: right;
    min-width: 160px;
    background-color:#F7F7F7;    
    border: 1px solid #D7D7D7;
}
.wiki-toc .active {
    background-color: #890C71;
    padding: 1px;
}
.wiki-toc .active a {
    color:white; 
}
.wiki-toc .active a:hover {
    background-color:  #890C71;
}
.indice-general {
/*    background-color: #FFFFDD;*/
}
.wikipage h1 {
    padding-top: 5px;
}
.wikipage h2 {
 padding: 2px;
}
.wikipage h1 {
    font-size: 28px;
}
.wikipage h2 {
    background-color: #890C71;
    color: white;
    padding-left: 10px;
    margin-top: 30px;
    font-size: 100%;
    border: 1px solid gray;
}
.wikipage h3 {
    font-size:100%;
}
li {
    margin-bottom:4px;
}
li * {
    margin-bottom:0;
}
/*a {
 color: #890C71;
}*/
@media print {
 .wiki-toc { display: none }
}
#tkt-changes-hdr, .tkt-chg-list { 
    font-size:80%;
    text-align:right;
}

</style>
 <script type="text/javascript" src="../../chrome/common/js/trac.js"></script>
</head>

			<body>
			<table border='0' cellspacing='0' cellpadding='0' height='48' width='100%'>
			  <tr>
			
				<td class='header-top-left'><img src='../../../../../api/media/logo.png' border='0'/></td>
			    <td class='header-top-right'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../api/media/wiki.png' />
			    	<a href='../../../../../api/index.html'  title='Navegar hacia la documentación PHP'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../api/media/php-small.png' /></a> 
			    	<a href='../../../../../api_js/index.html'  title='Navegar hacia la documentación Javascript'>    		
			    	<img border='0' style='vertical-align: middle' src='../../../../../api/media/javascript-small.png' /></a>
			  </tr>
			
			  <tr>
			    <td colspan='2' class='header-menu'>
			  		  [ <a href='http://desarrollos.siu.edu.ar/trac/toba/wiki/Referencia/Deployment' title='El sitio online contiene contenidos mas detallados y actualizados'
						class='menu'>Ver online</a> ]
			    </td>
			
			  </tr>
			  <tr><td colspan='2' class='header-line'><img src='../../../../../api/media/empty.png' width='1' height='1' border='0' alt=''  /></td></tr>
			</table>
		


<div id="banner">

<div id="header"><a id="logo" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba"><img src="../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a><hr /></div>

<form id="search" action="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/search" method="get">
 <div>
  <label for="proj-search">Search:</label>
  <input type="text" id="proj-search" name="q" size="10" accesskey="f" value="" />
  <input type="submit" value="Search" />
  <input type="hidden" name="wiki" value="on" />
  <input type="hidden" name="changeset" value="on" />
  <input type="hidden" name="ticket" value="on" />
 </div>
</form>



<div id="metanav" class="nav"><ul><li class="first"><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/login">Login</a></li><li><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/settings">Settings</a></li><li><a accesskey="6" href="../TracGuide.html">Help/Guide</a></li><li class="last"><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/about">About Trac</a></li></ul></div>
</div>

<div id="mainnav" class="nav"><ul><li class="active first"><a accesskey="1" href="../../wiki.html">Wiki</a></li><li><a accesskey="2" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/timeline">Timeline</a></li><li><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/browser">Browse Source</a></li><li class="last"><a accesskey="4" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/search">Search</a></li></ul></div>
<div id="main">




<div id="ctxtnav" class="nav">
 <h2>Wiki Navigation</h2>
 <ul>
   <li><a href="../../wiki.html">Start Page</a></li>
   <li><a href="../TitleIndex.html">Index by Title</a></li>
   <li><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/wiki/RecentChanges">Index by Date</a></li>
   <li class="last"><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/wiki/Referencia/Deployment?action=diff&amp;version=43">Last Change</a></li>
 </ul>
 <hr />
</div>

<div id="content" class="wiki">

 
  
  
   
   <div class="wikipage">
    <div id="searchable"><h1 id="Casosdeusodedeployment">Casos de uso de deployment</h1>
<p>
Los siguientes escenarios asumen la existencia de un control de versiones para el proyecto e instalaciones remotas.
</p>
<h2 id="PasajeDesarrollo-Producción">Pasaje Desarrollo - Producción</h2>
<p>
El escenario más común es tener una única instancia de desarrollo y actualizar otra instancia (generalmente Producción o Testing) de manera periódica. Este escenario puede describirse en cinco pasos:
</p>
<p>
<a style="padding:0; border:none" href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/attachment/wiki/Referencia/Deployment/desarrollo_produccion.png"><img src="../../attachment/wiki/Referencia/Deployment/desarrollo_produccion41f0.png?format=raw" /></a>
</p>
<ol><li><i>Desarrollo</i> - Exportación de metadatos: Siempre en desarrollo los últimos metadatos se encuentran en la base de datos (la instancia) y no en el sistema de archivos, esto es lógico porque los desarrolladores estuvieron utilizando el Editor en forma conjunta con esta instancia. La exportación se hace de la siguiente forma:
<pre class="wiki">toba proyecto exportar -p mi_proyecto
</pre></li><li><i>Desarrollo</i> - Commit de los nuevos archivos: El resultado de la exportación es la actualización de los archivos ubicados en la carpeta <i>metadatos</i> del proyecto. Junto a las modificaciones de código existentes se suben las modificaciones (commit) creando una nueva revisión, almacenada en un repositorio central.
</li><li><i>Producción</i> - Actualización de la nueva revisión: Suponiendo que se toma la decisión de actualizar el sistema en producción, el primer paso es actualizar el proyecto en cuestión, esto traerá los metadatos y el código actualizado.
</li><li><i>Producción</i> - Exportación de información local: Lo único que se necesita de la instancia en producción son sus usuarios, logs y demás metadatos considerados locales o propios de la instancia, para el resto de los metadatos valen los de desarrollo. Entonces es necesario exportar los datos locales de esta instancia almacenándose en el sistema de archivos:
<pre class="wiki">toba instancia exportar_local
</pre></li><li><i>Producción</i> - Regenerar el proyecto: Ahora que tanto los metadatos de desarrollo como los de los usuarios se encuentran en el sistema de archivos es posible regenerar el proyecto:
<pre class="wiki">toba proyecto regenerar -p mi_proyecto
</pre></li></ol><h2 id="PasajeDesarrollo-Producciónincluyendousuarios">Pasaje Desarrollo - Producción (incluyendo usuarios)</h2>
<ol><li><i>Desarrollo</i> - Exportación de metadatos: Siempre en desarrollo los últimos metadatos se encuentran en la base de datos (la instancia) y no en el sistema de archivos, esto es lógico porque los desarrolladores estuvieron utilizando el Editor en forma conjunta con esta instancia. La exportación se hace de la siguiente forma:
<pre class="wiki">toba proyecto exportar -p mi_proyecto
</pre></li><li><i>Desarrollo</i> - Commit de los nuevos archivos: El resultado de la exportación es la actualización de los archivos ubicados en la carpeta <i>metadatos</i> del proyecto. Junto a las modificaciones de código existentes se suben las modificaciones (commit) creando una nueva revisión, almacenada en un repositorio central.
</li><li><i>Desarrollo</i> - Copiar la carpeta <tt>toba/instalacion/i__&lt;instancia&gt;</tt> a producción. Esta carpeta contiene las .sql de los usuarios y como se vinculan al proyecto. Además contiene los logs de acceso y de aplicación, pueden borrarse estos archivos para no pasar el historial de desarrollo.
</li><li><i>Producción</i> - Actualización de la nueva revisión: El primer paso es actualizar el proyecto en cuestión, esto traerá los metadatos y el código actualizado.
</li><li><i>Producción</i> - Regenerar la instancia: Ahora que tanto los metadatos de desarrollo como los de los usuarios se encuentran en el sistema de archivos es posible regenerar la instancia. Ante la pregunta <i>Desea EXPORTAR antes la informacion local de la INSTANCIA?</i> responder NO, sino se perderá la información de usuarios traida desde desarrollo:
<pre class="wiki">toba instancia regenerar
</pre></li></ol><h2 id="PasajeDesarrollo-Producciónusandoinstaladorgráfico">Pasaje Desarrollo - Producción (usando instalador gráfico)</h2>
<ol><li><i>Desarrollo</i> - Descargar los fuentes del instalador en una carpeta al mismo nivel que toba. Por ejemplo si toba esta instalado en <tt>D:\proyectos\toba</tt>:
<pre class="wiki">svn co http://desarrollos.siu.edu.ar/svn/toba/instalador/trunk d:\proyectos\instalador
</pre></li><li><i>Desarrollo</i> - Por única vez copiar el archivo  <tt>d:\proyectos\instalador\ejemplo.proyecto.ini</tt> a la raiz del proyecto <tt>d:\proyectos\toba\proyectos\&lt;proyecto&gt;\proyecto.ini</tt> y ajustar las configuraciones
</li><li><i>Desarrollo</i> - Ejecutar 
<pre class="wiki">toba proyecto empaquetar -p &lt;proyecto&gt;
</pre></li><li><i>Desarrollo</i> - El resultado del empaquetado queda en la carpeta <tt>d:\proyectos\instalador_&lt;proyecto&gt;</tt>. Comprimirlo y pasarlo a producción.
</li><li><i>Producción</i> - Descomprimir el paquete en una carpeta navegable (ej. /var/www en debian o carpeta Apache htdocs en Windows)
</li><li><i>Producción</i> - Navegar hacia <a class="ext-link" href="../../../../external.html?link=http://localhost/instalador"><span class="icon">http://localhost/instalador</span></a>_&lt;proyecto&gt;/&lt;version&gt; y seguir las instrucciones
</li></ol><h2 id="ActualizacióndeToba">Actualización de Toba</h2>
<p>
Muchas veces es necesario actualizar la versión de toba con la que se está desarrollando (arreglo de bugs, nuevas funcionalidades deseadas, etc.), para esto hay que tener el cuidado de exportar los metadatos previo a la actualización, ya que actualizar toba muchas veces (no todas) implica regenerar la instancia.
</p>
<p>
<a style="padding:0; border:none" href="../../attachment/wiki/Referencia/Deployment/actualizacion_toba.html"><img src="../../attachment/wiki/Referencia/Deployment/actualizacion_toba41f0.png?format=raw" /></a>
</p>
<ol><li>Exportar Metadatos del proyecto: Como los últimos metadatos se encuentran en la base de datos (la instancia) es necesario llevarlas al sistema de archivos y <strong>versionarlos</strong>. Para cada proyecto propio ubicado en esta instancia se debe hacer:
<pre class="wiki">toba proyecto exportar -p mi_proyecto
</pre></li><li>Actualizar Toba: Se actualiza la nueva revisión de Toba desde el repositorio SVN.
</li><li>Actualización de metadatos: Es posible que la nueva versión requiera alguna migración automática (ver <a class="wiki" href="../Versiones.html">Versiones Toba</a>), para ello ejecutar:
<pre class="wiki">toba instalacion migrar
</pre></li></ol><p>
Por si la migración afecta algún metadato del proyecto es necesario volver a exportar al sistema de archivos:
</p>
<pre class="wiki">toba proyecto exportar -p mi_proyecto
</pre><p>
Con los nuevos metadatos de toba y los metadatos exportados del proyecto en el sistema de archivos es necesario volver a cargar la instancia:
</p>
<pre class="wiki">toba instancia regenerar
</pre><p>
Cabe notar que <tt>instancia regenerar</tt> como primer paso borra el contenido de la base, por lo que si la exportación no se efectuó o se efectuó con errores se perderán los datos del proyecto y sólo será posible recuperarlos desde alguna revisión del SVN del proyecto o algún backup manual.
</p>
<p>
Hay una razón por la cual la exportación se debe hacer antes que la actualización de código. Es posible que el nuevo código de toba haga referencia a nuevas columnas o nuevos campos no presentes en la instancia actual del proyecto (porque fue creada usando un toba más viejo). Si se quiere hacer la exportación luego de la actualización, este nuevo código va a querer exportar esta estructura de base de datos nueva no presente en la instancia actual, imposibilitando la extracción de los metadatos hacia el sistema de archivos. Hay una solución a este error, siempre y cuando no se haya ejecutado el tercer paso por la razón explicada en el párrafo anterior. La solución es volver atrás la revisión de toba a la misma con la que se generó la instancia y reiniciar el proceso.
</p>
<h2 id="MúltiplesInstalaciones">Múltiples Instalaciones</h2>
<p>
Para tener mútliples instalaciones de Toba en una misma máquina se deben tener en cuenta ciertas pautas adicionales a las básicas descriptas del proceso de <a class="wiki" href="../Instalacion.html">Instalación</a>.
</p>
<ul><li>En el include_path de PHP no debe estar incluído ninguna referencia a alguno de los toba instalados.
</li></ul><ul><li>Para ejecutar scripts administrativos (del tipo instancia o proyecto, por ejemplo) vamos a necesitar previamente agregar al path la ubicación de los mismos, además de setear el valor de las variables de entorno $toba_dir y $toba_instancia. El detalle de cómo crear estos ambientes se encuentra en la <a class="wiki" href="Consola.html">configuración de la consola</a>.
</li></ul><ul><li>Además de tener varias carpetas conteniendo las diferentes versiones de Toba, vamos a configurar igual cantidad de alias para el framework. Tomemos como ejemplo el caso de dos instalaciones: una en el directorio <i>d:/toba_1</i>, la otra en <i>d:/toba_2</i>. La configuración de Apache debería contener inicialmente estos alias:
</li></ul><pre class="wiki">    Alias /toba_1 "d:/toba_1/www"
    &lt;Directory "d:/toba_1/www/"&gt;
        AllowOverride None
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;

    Alias /toba_2 "d:/toba_2/www"
    &lt;Directory "d:/toba_2/www/"&gt;
        SetEnv TOBA_DIR D:/toba_2
        SetEnv TOBA_ALIAS toba_2
        AllowOverride None
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
</pre><p>
 
</p>
<ul><li>Cuando se defina el alias de cada proyecto se deberá especificar que versión de toba (alias de toba) utiliza, por ejemplo si tengo proyecto_1 utiliza toba_1 y proyecto_2 a toba_2:
</li></ul><pre class="wiki"> 
    Alias /proyecto_1 "d:/toba_1/proyectos/proyecto_1/www"
    &lt;Directory "d:/toba_1/proyectos/proyecto_1/www/"&gt;
                SetEnv TOBA_DIR			"d:/toba_1"
                SetEnv TOBA_ALIAS		"toba_1"
                SetEnv TOBA_PROYECTO_ALIAS	"proyecto_1"
                SetEnv TOBA_INSTANCIA		"desarrollo"
                DirectoryIndex aplicacion.php
        Options MultiViews
        AllowOverride None
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;

    Alias /proyecto_2 "d:/toba_1/proyectos/proyecto_2/www"
    &lt;Directory "d:/toba_1/proyectos/proyecto_2/www/"&gt;
                SetEnv TOBA_DIR			"d:/toba_2"
                SetEnv TOBA_ALIAS		"toba_2"
                SetEnv TOBA_PROYECTO_ALIAS	"proyecto_2"
                SetEnv TOBA_INSTANCIA		"desarrollo"
                DirectoryIndex aplicacion.php
        Options MultiViews
        AllowOverride None
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;

</pre></div>
   </div>
   
    <h3 id="tkt-changes-hdr">Attachments</h3>
    <ul class="tkt-chg-list"><li class="tkt-chg-change"><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/attachment/wiki/Referencia/Deployment/desarrollo_produccion.png">desarrollo_produccion.png</a> (30.4 kB) - added by seba on 07/14/05 14:40:32.</li><li class="tkt-chg-change"><a href="../../attachment/wiki/Referencia/Deployment/actualizacion_toba.html">actualizacion_toba.png</a> (14.5 kB) - added by seba on 07/14/05 16:01:09.</li>
    </ul>
  
  
  <script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
 
 
</div>

<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/wiki/Referencia/Deployment?format=txt">Plain Text</a></li></ul></div>

</div>

<div id="footer">
 <hr />
 <a id="tracpowered" href="../../../../external.html?link=http://trac.edgewall.org/"><img src="../../chrome/common/trac_logo_mini.png" height="30" width="107"
   alt="Trac Powered"/></a>
 <p class="left">
  Powered by <a href="../../../../external.html?link=https://desarrollos.siu.edu.ar/trac/toba/about"><strong>Trac 0.10.3</strong></a><br />
  By <a href="../../../../external.html?link=http://www.edgewall.org/">Edgewall Software</a>.
 </p>
 <p class="right">
  Creado por el SIU<br /><a href="../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a>
 </p>
</div>



 </body>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>

