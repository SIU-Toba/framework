<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
 <title>Referencia/ExtensionNucleo/Efs - SIU-Toba - Trac</title><link rel="start" href="../../../wiki.html" /><link rel="search" href="../../../../../external.html?link=https://localhost/trac/toba/search" /><link rel="help" href="../../TracGuide.html" /><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css" /><link rel="icon" href="../../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="../../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="alternate" href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/ExtensionNucleo/Efs?format=txt" title="Plain Text" type="text/x-trac-wiki" /><style type="text/css">
.wikipage h2 {border-bottom: 1px solid gray;}

/* trac php syntax highlighting */
.code-block {
    line-height: 1em;
    font-family: Courier, monotype;
    font-size: 12px;
    }
.h_question { color: #0000BB; } /* highlight.default */
.hphp_commentline { color: #FF8000; } /* highlight.comment */
.hphp_operator { color: #007700; } /* highlight.keyword */
.hphp_word { color: #007700; } /* highlight.keyword */
.hphp_default {}
.hphp_variable { color: #0000BB; } /* highlight.default */
.hphp_hstring { color: #DD0000; } /* highlight.string */
.hphp_simplestring { color: #DD0000; } /* highlight.string */
.h_tagunknown {}
.h_default {}

.code-keyword { color: #007700; font-weight: normal; }
.code-lang { color: #0000BB; font-weight: normal; }
.code-comment { color: #FF8000; font-weight: normal;}
.code-string { color: #DD0000; font-weight: normal;}

pre { padding:0; margin: 0}

.tablas-screenshots td:first-child { background-color: #D5CECD; width: 30%}
.tablas-screenshots table { width: 90%; border: 1px solid gray; }
.tablas-screenshots td { }
.tablas-screenshots table.wiki td { border: 1px solid gray; }

#tkt-changes-hdr {
    clear: both;
    padding-top: 30px;
}
.wiki-toc {
    clear: right;
    min-width: 160px;
    background-color:#F7F7F7;    
    border: 1px solid #D7D7D7;
}
.wiki-toc .active {
    background-color: #890C71;
    padding: 1px;
}
.wiki-toc .active a {
    color:white; 
}
.wiki-toc .active a:hover {
    background-color:  #890C71;
}
.indice-general {
/*    background-color: #FFFFDD;*/
}
.wikipage h1 {
    padding-top: 5px;
}
.wikipage h2 {
 padding: 2px;
}
.wikipage h1 {
    font-size: 28px;
}
.wikipage h2 {
    background-color: #890C71;
    color: white;
    padding-left: 10px;
    margin-top: 30px;
    font-size: 100%;
    border: 1px solid gray;
}
.wikipage h3 {
    font-size:100%;
}
li {
    margin-bottom:4px;
}
li * {
    margin-bottom:0;
}
/*a {
 color: #890C71;
}*/
@media print {
 .wiki-toc { display: none }
}
#tkt-changes-hdr, .tkt-chg-list { 
    font-size:80%;
    text-align:right;
}

</style>
 <script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
</head>

			<body>
			<table border='0' cellspacing='0' cellpadding='0' height='48' width='100%'>
			  <tr>
			
				<td class='header-top-left'><img src='../../../../../../api/media/logo.png' border='0'/></td>
			    <td class='header-top-right'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../../api/media/wiki.png' />
			    	<a href='../../../../../../api/index.html'  title='Navegar hacia la documentación PHP'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../../api/media/php-small.png' /></a> 
			    	<a href='../../../../../../api_js/index.html'  title='Navegar hacia la documentación Javascript'>    		
			    	<img border='0' style='vertical-align: middle' src='../../../../../../api/media/javascript-small.png' /></a>
			  </tr>
			
			  <tr>
			    <td colspan='2' class='header-menu'>
			  		  [ <a href='http://desarrollos2.siu.edu.ar/trac/toba/wiki/Referencia/ExtensionNucleo/Efs' title='El sitio online contiene contenidos mas detallados y actualizados'
						class='menu'>Ver online</a> ]
			    </td>
			
			  </tr>
			  <tr><td colspan='2' class='header-line'><img src='../../../../../../api/media/empty.png' width='1' height='1' border='0' alt=''  /></td></tr>
			</table>
		


<div id="banner">

<div id="header"><a id="logo" href="../../../../../external.html?link=https://localhost/trac/toba"><img src="../../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a><hr /></div>

<form id="search" action="../../../../../external.html?link=https://localhost/trac/toba/search" method="get">
 <div>
  <label for="proj-search">Search:</label>
  <input type="text" id="proj-search" name="q" size="10" accesskey="f" value="" />
  <input type="submit" value="Search" />
  <input type="hidden" name="wiki" value="on" />
  <input type="hidden" name="changeset" value="on" />
  <input type="hidden" name="ticket" value="on" />
 </div>
</form>



<div id="metanav" class="nav"><ul><li class="first"><a href="../../../../../external.html?link=https://localhost/trac/toba/login">Login</a></li><li><a href="../../../../../external.html?link=https://localhost/trac/toba/settings">Settings</a></li><li><a accesskey="6" href="../../TracGuide.html">Help/Guide</a></li><li class="last"><a href="../../../../../external.html?link=https://localhost/trac/toba/about">About Trac</a></li></ul></div>
</div>

<div id="mainnav" class="nav"><ul><li class="active first"><a accesskey="1" href="../../../wiki.html">Wiki</a></li><li><a accesskey="2" href="../../../../../external.html?link=https://localhost/trac/toba/timeline">Timeline</a></li><li><a href="../../../../../external.html?link=https://localhost/trac/toba/browser">Browse Source</a></li><li class="last"><a accesskey="4" href="../../../../../external.html?link=https://localhost/trac/toba/search">Search</a></li></ul></div>
<div id="main">



<div id="ctxtnav" class="nav">
 <h2>Wiki Navigation</h2>
 <ul>
   <li><a href="../../../wiki.html">Start Page</a></li>
   <li><a href="../../TitleIndex.html">Index by Title</a></li>
   <li><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/RecentChanges">Index by Date</a></li>
   <li class="last"><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/ExtensionNucleo/Efs?action=diff&amp;version=6">Last Change</a></li>
 </ul>
 <hr />
</div>

<div id="content" class="wiki">

 
  
  
   
   <div class="wikipage">
    <div id="searchable"><h1 id="ExtensiónyCreacióndeEfs">Extensión y Creación de Efs</h1>
<h2 id="Extensióndeparámetros">Extensión de parámetros</h2>
<p>
Para crear un nuevo parámetro de un ef hay que seguir tres pasos principales: 
</p>
<h3 id="Cambiosenladefinicióndelabase">Cambios en la definición de la base</h3>
<p>
Un nuevo parámetro de un ef generalmente se almacena como una nueva columna en la tabla de efs.
</p>
<ul><li>Definir un nuevo campo en la tabla <tt>apex_objeto_ei_formulario_ef</tt> en el archivo <tt>php/modelo/ddl/pgsql_a12_componente_ei_formulario.sql</tt>, usar algún prefijo para el nombre del campo (usar los campos actuales como guía).
</li><li>Exportar y regenerar la instancia (ahora el campo se encuentra en la base)
</li><li>Ejecutar <tt>toba nucleo parsear_ddl</tt>, esto va a permitir que el exportador exporte la nueva columna.
</li></ul><h3 id="Cambiosaltoba_editor">Cambios al toba_editor</h3>
<p>
El editor tiene que permitir editar y recuperar el parámetro de una instancia de ef dada. Para esto:
</p>
<ul><li>Abrir el editor toba, editando el mismo editor.
</li><li>En la vista de componentes, seleccionar el formulario 1000154 (Editor Parámetros Efs: parametros)
</li><li>En este formulario crear un nuevo ef con identificador igual que el nombre del campo. Dependiendo de los valores que pueda tomar el campo, definirlo como editable,combo, checkbox, etc. Grabar los cambios.
</li><li>Ahora editar el datos_tabla 1530 (de nombre OBJETO - EI formulario EF), en la definición de columnas agregar una nueva, con las propiedades del nuevo campo. Esto va a permitir a que el editor sepa como mapear el campo con la base. Grabar los cambios
</li><li>Tomar la clase php del ef al cual pertenece el nuevo parámetro (por ejemplo el toba_ef_multi_seleccion ubicado en php/nucleo/componentes/interface/efs/toba_ef_multi_seleccion.php), agregar al método estático <tt>get_lista_parametros</tt> el identificador del nuevo campo (si no existe el método redefinirlo y llamar al padre si lo tiene). Por ejemplo:
<div class="code"><pre><span class="code-lang">&lt;?php</span>
<span class="code-keyword">...
    static function </span><span class="code-lang">get_lista_parametros</span><span class="code-keyword">()
    {
        </span><span class="code-lang">$param</span><span class="code-keyword">[] = </span><span class="code-string">'selec_cant_minima'</span><span class="code-keyword">;
        </span><span class="code-lang">$param</span><span class="code-keyword">[] = </span><span class="code-string">'selec_cant_maxima'</span><span class="code-keyword">;
        </span><span class="code-lang">$param</span><span class="code-keyword">[] = </span><span class="code-string">'selec_utilidades'</span><span class="code-keyword">;
        </span><span class="code-lang">$param</span><span class="code-keyword">[] = </span><span class="code-string">'selec_serializar'</span><span class="code-keyword">;
        </span><span class="code-lang">$param</span><span class="code-keyword">[] = </span><span class="code-string">'selec_cantidad_columnas'</span><span class="code-keyword">;
        return </span><span class="code-lang">$param</span><span class="code-keyword">;        
    }
...</span>
<span class="code-lang">?&gt;</span>

</pre></div></li><li>En el editor de toba tomar un formulario de ejemplo que contenga un ef del tipo extendido. Verificar que ahora es permitido ingresar el valor del nuevo parámetro y que se almacena correctamente en la base de datos.
</li></ul><h3 id="Cambiosalaclase-phpdelef">Cambios a la clase-php del ef</h3>
<p>
Finalmente la clase-php del ef extendido necesita reaccionar ante la presencia del parámetro en ejecución, el nuevo parámetro llega al constructor:
</p>
<div class="code"><pre><span class="code-lang">&lt;?php
    </span><span class="code-keyword">function </span><span class="code-lang">__construct</span><span class="code-keyword">(</span><span class="code-lang">$padre</span><span class="code-keyword">,</span><span class="code-lang">$nombre_formulario</span><span class="code-keyword">, </span><span class="code-lang">$id</span><span class="code-keyword">,</span><span class="code-lang">$etiqueta</span><span class="code-keyword">,</span><span class="code-lang">$descripcion</span><span class="code-keyword">,</span><span class="code-lang">$dato</span><span class="code-keyword">,</span><span class="code-lang">$obligatorio</span><span class="code-keyword">,</span><span class="code-lang">$parametros</span><span class="code-keyword">)
    {
        </span><span class="code-lang">parent</span><span class="code-keyword">::</span><span class="code-lang">__construct</span><span class="code-keyword">(</span><span class="code-lang">$padre</span><span class="code-keyword">,</span><span class="code-lang">$nombre_formulario</span><span class="code-keyword">, </span><span class="code-lang">$id</span><span class="code-keyword">,</span><span class="code-lang">$etiqueta</span><span class="code-keyword">,</span><span class="code-lang">$descripcion</span><span class="code-keyword">,</span><span class="code-lang">$dato</span><span class="code-keyword">,</span><span class="code-lang">$obligatorio</span><span class="code-keyword">,</span><span class="code-lang">$parametros</span><span class="code-keyword">);
        if (isset(</span><span class="code-lang">$parametros</span><span class="code-keyword">[</span><span class="code-string">'selec_cant_columnas'</span><span class="code-keyword">])) {
            </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">cantidad_columnas </span><span class="code-keyword">= </span><span class="code-lang">$parametros</span><span class="code-keyword">[</span><span class="code-string">'selec_cant_columnas'</span><span class="code-keyword">];
        }
    } </span>
<span class="code-lang">?&gt;</span>

</pre></div><p>
Es conveniente verificar que exportando el proyecto, el valor de este parámetro cambia en el sistema de archivos.
</p>
<h2 id="CreacióndeEFs">Creación de EFs</h2>
<p>
Para crear un nuevo ef hay que seguir tres pasos principales:
</p>
<h3 id="Agregarelmetadatoalabase">Agregar el metadato a la base</h3>
<p>
Para ello se debe crear un nuevo registro en la tabla apex_elemento_formulario. Esta entrada se visualizará luego en la lista desplegable de tipos de elementos al agregar un nuevo ef en el editor de Toba. Hay que tener especial cuidado la información que representa cada campo.
</p>
<p>
Por ejemplo, para agrear un ef_editable_captcha, la sql sería:
</p>
<pre class="wiki">INSERT INTO 
 apex_elemento_formulario (elemento_formulario, padre, descripcion, parametros, proyecto, exclusivo_toba, obsoleto) 
VALUES 
 ('ef_editable_captcha', 'ef_editable', 'Campo para ingresar un codigo generado al azar.', NULL, 'toba', NULL, '0');
</pre><h3 id="AgregarlaclasealnucleodeToba">Agregar la clase al nucleo de Toba</h3>
<p>
Una vez creado el elemento, es necesario indicarle al nucleo de Toba, que archivo será el encargado de contener la clase para el mismo. Para ello hay que modificar el archivo php/nucleo/toba_nucleo.php y agregar un elemento más al arreglo que retorna el método get_indice_archivos(). Este método se llama en el autoload de Toba.
</p>
<div class="code"><pre><span class="code-lang">&lt;?php
  </span><span class="code-keyword">static function </span><span class="code-lang">get_indice_archivos</span><span class="code-keyword">()
  {
     return array(
           .
           .
          </span><span class="code-string">'toba_ef_editable_captcha'      </span><span class="code-keyword">=&gt; </span><span class="code-string">'nucleo/componentes/interface/efs/toba_ef_editable_captcha.php'</span><span class="code-keyword">,
           .
           .</span>
<span class="code-lang">?&gt;</span>

</pre></div><h3 id="ExportarMetadatos">Exportar Metadatos</h3>
<p>
Para guardar los cambios en el sistema de archivos de Toba, es necesario exportar los metadatos de la instancia. Para ello ejecutar:
</p>
<pre class="wiki">toba nucleo exportar_datos
</pre></div>
   </div>
   
  
  <script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
 
 
</div>

<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/ExtensionNucleo/Efs?format=txt">Plain Text</a></li></ul></div>

</div>

<div id="footer">
 <hr />
 <a id="tracpowered" href="../../../../../external.html?link=http://trac.edgewall.org/"><img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107"
   alt="Trac Powered"/></a>
 <p class="left">
  Powered by <a href="../../../../../external.html?link=https://localhost/trac/toba/about"><strong>Trac 0.10.3</strong></a><br />
  By <a href="../../../../../external.html?link=http://www.edgewall.org/">Edgewall Software</a>.
 </p>
 <p class="right">
  Creado por el SIU<br /><a href="../../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a>
 </p>
</div>



 </body>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>

