<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="../../../../../external.html?link=http://www.w3.org/1999/xhtml">
  
  

  


  

  <!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
    <title>
      Referencia/ExtensionNucleo/Efs – SIU-Toba
    </title>
        <link rel="search" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/search" />
        <link rel="help" href="../../TracGuide.html" />
        <link rel="alternate" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/wiki/Referencia/ExtensionNucleo/Efs?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="up" href="../ExtensionNucleo.html" title="View parent page" />
        <link rel="start" href="../../../wiki.html" />
        <link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css" />
        <link rel="shortcut icon" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/search/opensearch" title="Search SIU-Toba" />
    <script type="text/javascript" src="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/chrome/common/js/jquery.js"></script><script type="text/javascript" src="../../../chrome/common/js/trac.js"></script><script type="text/javascript" src="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/chrome/common/js/search.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/toba/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor("Link to this section");
      });
    </script>
    <script type="text/javascript" src="../../../chrome/site/mootools.js"></script>
    <script type="text/javascript" src="../../../chrome/site/slimbox.js"></script>
    <link rel="stylesheet" href="../../../chrome/site/portada.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../chrome/site/slimbox.css" type="text/css" media="screen" />
    <a style="position: absolute; top: 5px; left:5px;border-bottom:none !important;" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba"><img src="../../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a>
    <link rel="stylesheet" type="text/css" href="../../../chrome/site/style.css" />
  </head>
  <body>
<a style="position: absolute; top: 5px; left:5px;border-bottom:none !important;" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba"><img src="../../../chrome/site/logo_toba_siu_original.gif" width="282" height="90" alt="SIU-Toba" /></a>
    <div id="siteheader">
    </div>
    <div id="banner">
      <div id="header">
        <a id="logo" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba"><img src="../../../chrome/site/logo_toba_siu.gif" alt="Toba" height="90" width="282" /></a>
      </div>
      <form id="search" action="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/login">Login</a></li><li><a href="../../TracGuide.html">Help/Guide</a></li><li><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/about">About Trac</a></li><li class="last"><a href="../../../prefs.html">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="../../../wiki.html">Wiki</a></li><li><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/timeline">Timeline</a></li><li><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/roadmap">Roadmap</a></li><li><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/browser">Browse Source</a></li><li><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/query">View Tickets</a></li><li class="last"><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="../ExtensionNucleo.html">Up</a></li><li><a href="../../WikiStart.html">Start Page</a> / <a href="../../Referencia.html">Referencia</a> / <a href="../ExtensionNucleo.html">ExtensionNucleo</a> / Efs</li><li><a href="../../TitleIndex.html">Index</a></li><li><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/wiki/Referencia/ExtensionNucleo/Efs?action=history">History</a></li><li class="last"><a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/wiki/Referencia/ExtensionNucleo/Efs?action=diff&amp;version=7">Last Change</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <p class="path noprint">
        <a class="pathentry" title="View Referencia" href="../../Referencia.html">Referencia</a><span class="pathentry sep">/</span><a class="pathentry" title="View Referencia/ExtensionNucleo" href="../ExtensionNucleo.html">ExtensionNucleo</a><span class="pathentry sep">/</span><a class="pathentry" title="View Referencia/ExtensionNucleo/Efs" href="Efs.html">Efs</a>
        <br style="clear: both" />
      </p>
      <div class="wikipage searchable">
        
          <h1 id="ExtensiónyCreacióndeEfs">Extensión y Creación de Efs</h1>
<h2 id="Extensióndeparámetros">Extensión de parámetros</h2>
<p>
Para crear un nuevo parámetro de un ef hay que seguir tres pasos principales: 
</p>
<h3 id="Cambiosenladefinicióndelabase">Cambios en la definición de la base</h3>
<p>
Un nuevo parámetro de un ef generalmente se almacena como una nueva columna en la tabla de efs.
</p>
<ul><li>Definir un nuevo campo en la tabla <tt>apex_objeto_ei_formulario_ef</tt> en el archivo <tt>php/modelo/ddl/pgsql_a12_componente_ei_formulario.sql</tt>, usar algún prefijo para el nombre del campo (usar los campos actuales como guía).
</li><li>Exportar y regenerar la instancia (ahora el campo se encuentra en la base)
</li><li>Ejecutar <tt>toba nucleo parsear_ddl</tt>, esto va a permitir que el exportador exporte la nueva columna.
</li></ul><h3 id="Cambiosaltoba_editor">Cambios al toba_editor</h3>
<p>
El editor tiene que permitir editar y recuperar el parámetro de una instancia de ef dada. Para esto:
</p>
<ul><li>Abrir el editor toba, editando el mismo editor.
</li><li>En la vista de componentes, seleccionar el formulario 1000154 (Editor Parámetros Efs: parametros)
</li><li>En este formulario crear un nuevo ef con identificador igual que el nombre del campo. Dependiendo de los valores que pueda tomar el campo, definirlo como editable,combo, checkbox, etc. Grabar los cambios.
</li><li>Ahora editar el datos_tabla 1530 (de nombre OBJETO - EI formulario EF), en la definición de columnas agregar una nueva, con las propiedades del nuevo campo. Esto va a permitir a que el editor sepa como mapear el campo con la base. Grabar los cambios
</li><li>Tomar la clase php del ef al cual pertenece el nuevo parámetro (por ejemplo el toba_ef_multi_seleccion ubicado en php/nucleo/componentes/interface/efs/toba_ef_multi_seleccion.php), agregar al método estático <tt>get_lista_parametros</tt> el identificador del nuevo campo (si no existe el método redefinirlo y llamar al padre si lo tiene). Por ejemplo:
<div class="code"><pre><span class="cp">&lt;?php</span>
<span class="o">...</span>
    <span class="k">static</span> <span class="k">function</span> <span class="nf">get_lista_parametros</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$param</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'selec_cant_minima'</span><span class="p">;</span>
        <span class="nv">$param</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'selec_cant_maxima'</span><span class="p">;</span>
        <span class="nv">$param</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'selec_utilidades'</span><span class="p">;</span>
        <span class="nv">$param</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'selec_serializar'</span><span class="p">;</span>
        <span class="nv">$param</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'selec_cantidad_columnas'</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$param</span><span class="p">;</span>      
    <span class="p">}</span>
<span class="o">...</span>
<span class="cp">?&gt;</span><span class="x">
</span></pre></div></li><li>En el editor de toba tomar un formulario de ejemplo que contenga un ef del tipo extendido. Verificar que ahora es permitido ingresar el valor del nuevo parámetro y que se almacena correctamente en la base de datos.
</li></ul><h3 id="Cambiosalaclase-phpdelef">Cambios a la clase-php del ef</h3>
<p>
Finalmente la clase-php del ef extendido necesita reaccionar ante la presencia del parámetro en ejecución, el nuevo parámetro llega al constructor:
</p>
<div class="code"><pre><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$padre</span><span class="p">,</span><span class="nv">$nombre_formulario</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span><span class="nv">$etiqueta</span><span class="p">,</span><span class="nv">$descripcion</span><span class="p">,</span><span class="nv">$dato</span><span class="p">,</span><span class="nv">$obligatorio</span><span class="p">,</span><span class="nv">$parametros</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$padre</span><span class="p">,</span><span class="nv">$nombre_formulario</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span><span class="nv">$etiqueta</span><span class="p">,</span><span class="nv">$descripcion</span><span class="p">,</span><span class="nv">$dato</span><span class="p">,</span><span class="nv">$obligatorio</span><span class="p">,</span><span class="nv">$parametros</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$parametros</span><span class="p">[</span><span class="s1">'selec_cant_columnas'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cantidad_columnas</span> <span class="o">=</span> <span class="nv">$parametros</span><span class="p">[</span><span class="s1">'selec_cant_columnas'</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span> 
<span class="cp">?&gt;</span><span class="x">
</span></pre></div><p>
Es conveniente verificar que exportando el proyecto, el valor de este parámetro cambia en el sistema de archivos.
</p>
<h2 id="CreacióndeEFs">Creación de EFs</h2>
<p>
Para crear un nuevo ef hay que seguir tres pasos principales:
</p>
<h3 id="Agregarelmetadatoalabase">Agregar el metadato a la base</h3>
<p>
Para ello se debe crear un nuevo registro en la tabla apex_elemento_formulario. Esta entrada se visualizará luego en la lista desplegable de tipos de elementos al agregar un nuevo ef en el editor de Toba. Hay que tener especial cuidado la información que representa cada campo.
</p>
<p>
Por ejemplo, para agrear un ef_editable_captcha, la sql sería:
</p>
<pre class="wiki">INSERT INTO 
 apex_elemento_formulario (elemento_formulario, padre, descripcion, parametros, proyecto, exclusivo_toba, obsoleto) 
VALUES 
 ('ef_editable_captcha', 'ef_editable', 'Campo para ingresar un codigo generado al azar.', NULL, 'toba', NULL, '0');
</pre><h3 id="AgregarlaclasealnucleodeToba">Agregar la clase al nucleo de Toba</h3>
<p>
Una vez creado el elemento, es necesario indicarle al nucleo de Toba, que archivo será el encargado de contener la clase para el mismo. Para ello hay que modificar el archivo php/nucleo/toba_nucleo.php y agregar un elemento más al arreglo que retorna el método get_indice_archivos(). Este método se llama en el autoload de Toba.
</p>
<div class="code"><pre><span class="cp">&lt;?php</span>
  <span class="k">static</span> <span class="k">function</span> <span class="nf">get_indice_archivos</span><span class="p">()</span>
  <span class="p">{</span>
     <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
           <span class="o">.</span>
           <span class="o">.</span>
          <span class="s1">'toba_ef_editable_captcha'</span>      <span class="o">=&gt;</span> <span class="s1">'nucleo/componentes/interface/efs/toba_ef_editable_captcha.php'</span><span class="p">,</span>
           <span class="o">.</span>
           <span class="o">.</span>
<span class="cp">?&gt;</span><span class="x">
</span></pre></div><h3 id="ExportarMetadatos">Exportar Metadatos</h3>
<p>
Para guardar los cambios en el sistema de archivos de Toba, es necesario exportar los metadatos de la instancia. Para ello ejecutar:
</p>
<pre class="wiki">toba nucleo exportar_datos
</pre>
        
        
      </div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("../../../pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/wiki/Referencia/ExtensionNucleo/Efs?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="../../../../../external.html?link=http://trac.edgewall.org/"><img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">
        Powered by <a href="../../../../../external.html?link=https://repositorio.siu.edu.ar/trac/toba/about"><strong>Trac 0.11.7</strong></a><br />
        By <a href="../../../../../external.html?link=http://www.edgewall.org/">Edgewall Software</a>.
      </p>
      <p class="right">Creado por SIU<br /><a href="../../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a></p>
    </div>
    <div id="sitefooter">
    </div>
<script type="text/javascript">
if (document.getElementById('link_php')) {
document.getElementById('link_php').onclick = function() {
    location.href = '../../../../../external.html?link=http://desarrollos.siu.edu.ar/toba_editor_trunk/doc/api/index.html';
    return false;
}
document.getElementById('link_js').onclick = function() {
    location.href = '../../../../../external.html?link=http://desarrollos.siu.edu.ar/toba_editor_trunk/doc/api_js/index.html';
    return false;
}
document.getElementById('link_wiki').onclick = function() {
    location.href = '../../Referencia.html';
    return false;
}
}
</script>
  </body>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>