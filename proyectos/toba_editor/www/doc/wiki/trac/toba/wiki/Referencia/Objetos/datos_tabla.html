<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
 <title>Referencia/Objetos/datos_tabla - SIU-Toba - Trac</title><link rel="start" href="../../../wiki.html" /><link rel="search" href="../../../../../external.html?link=https://localhost/trac/toba/search" /><link rel="help" href="../../TracGuide.html" /><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css" /><link rel="icon" href="../../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="../../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="alternate" href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/Objetos/datos_tabla?format=txt" title="Plain Text" type="text/x-trac-wiki" /><style type="text/css">
.wikipage h2 {border-bottom: 1px solid gray;}

/* trac php syntax highlighting */
.code-block {
    line-height: 1em;
    font-family: Courier, monotype;
    font-size: 12px;
    }
.h_question { color: #0000BB; } /* highlight.default */
.hphp_commentline { color: #FF8000; } /* highlight.comment */
.hphp_operator { color: #007700; } /* highlight.keyword */
.hphp_word { color: #007700; } /* highlight.keyword */
.hphp_default {}
.hphp_variable { color: #0000BB; } /* highlight.default */
.hphp_hstring { color: #DD0000; } /* highlight.string */
.hphp_simplestring { color: #DD0000; } /* highlight.string */
.h_tagunknown {}
.h_default {}

.code-keyword { color: #007700; font-weight: normal; }
.code-lang { color: #0000BB; font-weight: normal; }
.code-comment { color: #FF8000; font-weight: normal;}
.code-string { color: #DD0000; font-weight: normal;}

pre { padding:0; margin: 0}

.tablas-screenshots td:first-child { background-color: #D5CECD; width: 30%}
.tablas-screenshots table { width: 90%; border: 1px solid gray; }
.tablas-screenshots td { }
.tablas-screenshots table.wiki td { border: 1px solid gray; }

#tkt-changes-hdr {
    clear: both;
    padding-top: 30px;
}
.wiki-toc {
    clear: right;
    min-width: 160px;
    background-color:#F7F7F7;    
    border: 1px solid #D7D7D7;
}
.wiki-toc .active {
    background-color: #890C71;
    padding: 1px;
}
.wiki-toc .active a {
    color:white; 
}
.wiki-toc .active a:hover {
    background-color:  #890C71;
}
.indice-general {
/*    background-color: #FFFFDD;*/
}
.wikipage h1 {
    padding-top: 5px;
}
.wikipage h2 {
 padding: 2px;
}
h1 {
    font-size: 28px;
}
.wikipage h2 {
    background-color: #890C71;
    color: white;
    padding-left: 10px;
    margin-top: 30px;
    font-size: 100%;
    border: 1px solid gray;
}
.wikipage h3 {
    font-size:100%;
}
.wikipage {
padding-right:10px;
}
li {
    margin-bottom:6px;
}
li * {
    margin-bottom:3px;
}
/*a {
 color: #890C71;
}*/
@media print {
 .wiki-toc { display: none }
}
#tkt-changes-hdr, .tkt-chg-list { 
    font-size:80%;
    text-align:right;
}

/** Cambios globales **/
#ctxtnav {
 /*display:none;*/
}
#mainnav {
 border: none;
 background: white;
 margin: 0;
 padding-top: 10px;
 padding-bottom: 35px;
border-bottom:1px solid #CCCCCC;

}
#mainnav li {
 border: 1px solid lightGray;
}
#header {
 display:none;
}
body {
    margin: 0;
    padding: 0;
      background-color:#F3F3F3;	    
}
#content {
clear: both;

}
#banner {
    background-color: white;
    padding-right:10px;
    padding-top:10px;
}

#mainnav .active :link, #mainnav .active :visited {
background:#890B72;
border-right:1px solid #000000;
border-top:medium none;
color:#EEEEEE;
font-weight:bold;
}
#mainnav :link, #mainnav :visited {
 border: none;
 background: transparent;
}
:link, :visited {
/* color: #1020EB;*/
/* color: #0C1BBC; */
 color: #67065D ;

}
#main {
 padding-left: 10px;
}
#footer {
 background-color: white;
 border-bottom: 1px solid;
}
</style>
 <script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
</head>

			<body>
			<table border='0' cellspacing='0' cellpadding='0' height='48' width='100%'>
			  <tr>
			
				<td class='header-top-left'><img src='../../../../../../api/media/logo.png' border='0'/></td>
			    <td class='header-top-right'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../../api/media/wiki.png' />
			    	<a href='../../../../../../api/index.html'  title='Navegar hacia la documentación PHP'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../../api/media/php-small.png' /></a> 
			    	<a href='../../../../../../api_js/index.html'  title='Navegar hacia la documentación Javascript'>    		
			    	<img border='0' style='vertical-align: middle' src='../../../../../../api/media/javascript-small.png' /></a>
			  </tr>
			
			  <tr>
			    <td colspan='2' class='header-menu'>
			  		  [ <a href='http://desarrollos.siu.edu.ar/trac/toba/wiki/Referencia/Objetos/datos_tabla' title='El sitio online contiene contenidos mas detallados y actualizados'
						class='menu'>Ver online</a> ]
			    </td>
			
			  </tr>
			  <tr><td colspan='2' class='header-line'><img src='../../../../../../api/media/empty.png' width='1' height='1' border='0' alt=''  /></td></tr>
			</table>
		

<script type="text/javascript" src="../../../chrome/site/mootools.js"></script>
<script type="text/javascript" src="../../../chrome/site/slimbox.js"></script>
<link rel="stylesheet" href="../../../chrome/site/portada.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../chrome/site/slimbox.css" type="text/css" media="screen" />
<a style='position: absolute; top: 5px; left:5px;border-bottom:none !important;' href="../../../../../external.html?link=https://localhost/trac/toba"><img src="../../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a>

<div id="banner">

<div id="header"><a id="logo" href="../../../../../external.html?link=https://localhost/trac/toba"><img src="../../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a><hr /></div>

<form id="search" action="../../../../../external.html?link=https://localhost/trac/toba/search" method="get">
 <div>
  <label for="proj-search">Search:</label>
  <input type="text" id="proj-search" name="q" size="10" accesskey="f" value="" />
  <input type="submit" value="Search" />
  <input type="hidden" name="wiki" value="on" />
  <input type="hidden" name="changeset" value="on" />
  <input type="hidden" name="ticket" value="on" />
 </div>
</form>



<div id="metanav" class="nav"><ul><li class="first"><a href="../../../../../external.html?link=https://localhost/trac/toba/login">Login</a></li><li><a href="../../../../../external.html?link=https://localhost/trac/toba/settings">Settings</a></li><li><a accesskey="6" href="../../TracGuide.html">Help/Guide</a></li><li class="last"><a href="../../../../../external.html?link=https://localhost/trac/toba/about">About Trac</a></li></ul></div>
</div>

<div id="mainnav" class="nav"><ul><li class="active first"><a accesskey="1" href="../../../wiki.html">Wiki</a></li><li><a accesskey="2" href="../../../../../external.html?link=https://localhost/trac/toba/timeline">Timeline</a></li><li><a accesskey="3" href="../../../../../external.html?link=https://localhost/trac/toba/roadmap">Roadmap</a></li><li><a href="../../../../../external.html?link=https://localhost/trac/toba/browser">Browse Source</a></li><li><a href="../../../../../external.html?link=https://localhost/trac/toba/query">View Tickets</a></li><li><a accesskey="7" href="../../../../../external.html?link=https://localhost/trac/toba/newticket">New Ticket</a></li><li class="last"><a accesskey="4" href="../../../../../external.html?link=https://localhost/trac/toba/search">Search</a></li></ul></div>
<div id="main">




<div id="ctxtnav" class="nav">
 <h2>Wiki Navigation</h2>
 <ul>
   <li><a href="../../../wiki.html">Start Page</a></li>
   <li><a href="../../TitleIndex.html">Index by Title</a></li>
   <li><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/RecentChanges">Index by Date</a></li>
   <li class="last"><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/Objetos/datos_tabla?action=diff&amp;version=31">Last Change</a></li>
 </ul>
 <hr />
</div>

<div id="content" class="wiki">

 
  
  
   
   <div class="wikipage">
    <div id="searchable"><p>
<a href="../../WikiStart.html">Inicio</a> / <a href="../../Referencia.html">Referencia</a> / <a href="../Objetos.html">Objetos</a> / datos_tabla
</p>
<h1 id="datos_tabla">datos_tabla</h1>
<p>
Un <img onerror='alert("No se encuentra la imagen: " + this.src)' style='vertical-align:middle' border=0 src='../../../../../toba_trunk/img/objetos/datos_tabla.gif' /> datos_tablas mantiene una estructura tabular (o también llamada <a class="wiki" href="../../RecordSet.html">RecordSet</a>) y brinda una interface para trabajar con ella.
Sus principales características son:
</p>
<ul><li>Utiliza un <a class="wiki" href="AP.html">administrador de persistencia</a> para cargar los datos desde un medio de persistencia.
</li><li>Una vez en memoria existen <a class="wiki" href="datos_tabla.html#primitivas">Primitivas</a> para trabajar sobre estos datos.
</li><li>Los datos y sus modificaciones son mantenidos automáticamente en sesión entre los distintos pedidos de página. Esto quiere decir que cuando se pide modificar un dato esta modificación se retiene hasta el final de la <a class="wiki" href="../MarcoTransaccional.html">transacción de negocios</a>.
</li><li>Una vez terminada la edición se hace la sincronización con el medio de persistencia a través del <a class="wiki" href="AP.html">administrador de persistencia</a>, marcando el final de la transacción de negocios.
</li></ul><blockquote>
<p>
<a href='../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api/Componentes/Persistencia/toba_datos_tabla.html#' title='Navega hacia la documentacion PHP'><img style='vertical-align:middle' src='../../../../../toba_editor_trunk/doc/api/media/php-small.png' /> toba_datos_tabla</a> <br />
</p>
</blockquote>
<h2 id="Definición">Definición</h2>
<ul><li>Tabla: Nombre físico de la tabla en la base de datos
</li><li>Tipo de persistencia: <a class="wiki" href="AP.html">administrador de persistencia</a> que se utilizará, optativamente se puede personalizar alguno a manera de subclase.
</li><li>Permitir modificar claves: Por defecto las claves definidas no son modificables.
</li></ul><h2 id="Primitivas">Primitivas</h2>
<p>
La mejor forma de entender las primitivas es revisando el <strong><a href='../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api/Componentes/Persistencia/toba_datos_tabla.html#' title='Navega hacia la documentacion PHP'><img style='vertical-align:middle' src='../../../../../toba_editor_trunk/doc/api/media/php-small.png' /> API</a></strong>, a continuación se dan ejemplos a manera de resumen de las primitivas más utilizadas:
</p>
<h3 id="Carga">Carga</h3>
<p>
Generalmente la carga y sincronización son dos procesos que la tabla no maneja en forma aislada sino que es sólo un participante más de la <img onerror='alert("No se encuentra la imagen: " + this.src)' style='vertical-align:middle' border=0 src='../../../../../toba_trunk/img/objetos/datos_relacion.gif' /> <a class="wiki" href="datos_relacion.html">relación</a> a la que pertenece. En caso de que la operación maneje una tabla aislada (como pueden ser los ABMs de tablas simples) la carga generalmente se hace restringiendo por valores específicos de campos:
</p>
<pre class="wiki">$tabla-&gt;cargar(array('id' =&gt; 8)); 
</pre><h3 id="Trabajoconunúnicoregistro">Trabajo con un único registro</h3>
<p>
La operación puede trabajar con un conjunto masivo de filas o registros, o simplemente con un solo. Este último caso es el más sencillo, asumiendo que la carga anterior siempre asegura un único registro (con <i>id 8</i>), para consultar su contenido se ejecuta:
</p>
<pre class="wiki">$datos = $tabla-&gt;get();
ei_arbol($datos);
</pre><p>
Por ejemplo el usuario puede modificar el contenido de la fila y pedir posteriormente la modificación en la tabla:
</p>
<pre class="wiki">$datos['nombre'] = "Nuevo nombre";
$tabla-&gt;set($datos);
</pre><h3 id="Trabajoconvariosregistros">Trabajo con varios registros</h3>
<p>
Las primitivas permiten:
</p>
<ul><li>Consultar los datos de una fila <tt>$tabla-&gt;get_fila($id_fila);</tt>
</li><li>Consultar los datos de varias filas <tt>$tabla-&gt;get_filas($condiciones, true)</tt>
</li><li>Crear una nueva fila: <tt>$tabla-&gt;nueva_fila($datos);</tt>
</li><li>Modificar una fila: <tt>$tabla-&gt;modificar_fila($id_fila, $datos);</tt>
</li><li>Eliminar una fila: <tt>$tabla-&gt;eliminar_fila($id_fila);</tt>
</li><li>Procesar cambios masivos sobre filas <tt>$tabla-&gt;procesar_filas($cambios);</tt> donde $cambios es una matriz asociativa de filas la clave de cada fila es el $id_fila y cada una tiene una columna especial referenciada por la constante <tt>apex_ei_analisis_fila</tt> que marca el proceso a aplicar a la fila por ejemplo:
<pre class="wiki">$cambios = array(
		1001 =&gt; array(apex_ei_analisis_fila =&gt; 'M', 'nombre' =&gt; 'Es una modificación'),
		1010 =&gt; array(apex_ei_analisis_fila =&gt; 'A', 'nombre' =&gt; 'Es una alta'),
		1011 =&gt; array(apex_ei_analisis_fila =&gt; 'B')
	);
</pre></li></ul><p>
En todos los casos cuando se habla de $id_fila es la identificación propia de la fila <strong>no relacionada</strong> con la clave de la tabla física.
</p>
<h3 id="Sincronización">Sincronización</h3>
<p>
Al finalizar el trabajo en memoria se pide sincronizar con el medio de persistencia 
</p>
<pre class="wiki">$tabla-&gt;sincronizar();
</pre><p>
La sincronización construye los comandos SQL necesarios (updates o inserts) dependiendo de siel registro es nuevo o es sólo una modificación de la carga y los ejecuta dentro de una transacción.
</p>
<h3 id="Eliminación">Eliminación</h3>
<p>
Para eliminar <strong>TODAS</strong> las filas <strong>cargadas</strong> de una tabla se pueden optar por dos caminos:
</p>
<ul><li>Hacerlo a través del <strong>trabajo en memoria</strong> más <strong>sincronización</strong>:
<pre class="wiki">$tabla-&gt;eliminar_filas();
$tabla-&gt;sincronizar();
</pre></li></ul><p>
Esta opción es útil cuando las filas a eliminar se encuentran cargadas en memoria.
</p>
<ul><li>Hacerlo a través de una primitiva de eliminación masiva, esta primitiva elimina directamente desde el mecanismo de persistencia
<pre class="wiki">$tabla-&gt;eliminar_todo()
</pre></li></ul><p>
Esta opción es útil cuando las filas no están cargadas, sino que se borra utilizando una opción externa, sin ver el contenido de las filas.
</p>
<p>
Nota: Recordar que este estos son los pasos para la carga y sincronización de una tabla aislada, el proceso cambia cuando la tabla está involucrada en un <a class="wiki" href="datos_relacion.html">objeto relación</a>.
</p>
<p>
Más información se encuentra en el <a href='../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api/Componentes/Persistencia/toba_datos_tabla.html#' title='Navega hacia la documentacion PHP'><img style='vertical-align:middle' src='../../../../../toba_editor_trunk/doc/api/media/php-small.png' /> API</a>.
</p>
<h2 id="ColumnasExternas">Columnas Externas</h2>
<p>
Dentro de la transacción es probable que los contenidos de la tabla quieran ser presentados de una forma amigable al usuario. Así por ejemplo las claves foráneas tienen que mostrar su descripción y no su valor, para esto hay dos opciones:
</p>
<ul><li>Agrego la columna 'descripcion' a la tabla y marcarla como externa. De esta forma su valor estará disponible pero no participará de la sincronización.
</li><li>En el ci, relleno los datos haciendo la consulta manualmente cada vez que se pide esta información.
</li></ul><p>
El caso recomendado es el primero en donde se agrega la columna en la definición datos_tabla y se lo marca como externa. Además se tiene que brindar una forma de cargarla, ya sea a través de un SQL o a través de la invocación de un método PHP. Para esto último existe una solapa en el editor del datos_tabla.
</p>
<p>
Por ejemplo en el proyecto Referencia, ítem <tt>Operaciones Simples -&gt; ABM de Personas</tt>, en la pantalla de deportes se quieren listar las descripciones del mismo. Entonces se agregan los campos que describen el deporte y el día de semana:
</p>
<p>
<a style="padding:0; border:none" href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_definicion.html"><img src="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_definicion41f0.png?format=raw" /></a>
</p>
<p>
<a style="padding:0; border:none" href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_carga.html"><img src="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_carga41f0.png?format=raw" /></a>
</p>
<p>
Tanto si se utiliza como medio de carga la consulta SQL o el método PHP, en ambos casos el resultado a devolver debe ser un registro que contenga la/s columna/s correspondientes para la carga de los valores 'externos'.
En el caso de la carga por método PHP que se base en la realización de una consulta SQL, puede ser necesaria una conversión del resultado del formato Recordset al formato registro, para evitar este paso y sabiendo a priori que la consulta retornará siempre un solo registro se puede utilizar también el metodo <i>toba::db()-&gt;consultar_fila($SQL)</i> al momento de realizar la query.
Para una carga donde se arme el resultado a mano, el mismo deberá tener una estructura similar a la del siguiente ejemplo:
</p>
<pre class="wiki">$ejemplo_resultado_dao = array(
		'desc_deporte' =&gt; 'Motociclismo',
		'nombre' =&gt; 'Siambretta 150',
		'desc_dia_semana' =&gt; $datos[0]['dia_semana']
	);
</pre><h2 id="Másinfo">Más info</h2>
<ul><li>Ejemplo en el <a class="wiki" href="../../Proyectos/Referencia.html">proyecto Referencia</a>, ítems bajo la rama "Operaciones Simples"
</li><li><a class="wiki" href="Persistencia.html">Introducción a los objetos de persistencia</a>.
</li></ul></div>
   </div>
   
    <h3 id="tkt-changes-hdr">Attachments</h3>
    <ul class="tkt-chg-list"><li class="tkt-chg-change"><a href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_definicion.html">externos_definicion.png</a> (3.8 kB) - added by seba on 12/21/06 11:44:02.</li><li class="tkt-chg-change"><a href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_carga.html">externos_carga.png</a> (5.7 kB) - added by seba on 12/21/06 11:46:53.</li>
    </ul>
  
  
  <script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
 
 
</div>

<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/Objetos/datos_tabla?format=txt">Plain Text</a></li></ul></div>

</div>

<div id="footer">
 <hr />
 <a id="tracpowered" href="../../../../../external.html?link=http://trac.edgewall.org/"><img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107"
   alt="Trac Powered"/></a>
 <p class="left">
  Powered by <a href="../../../../../external.html?link=https://localhost/trac/toba/about"><strong>Trac 0.10.3</strong></a><br />
  By <a href="../../../../../external.html?link=http://www.edgewall.org/">Edgewall Software</a>.
 </p>
 <p class="right">
  Creado por SIU<br /><a href="../../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a>
 </p>
</div>


<script type='text/javascript'>
if (document.getElementById('link_php')) {
document.getElementById('link_php').onclick = function() {
    location.href = '../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api/index.html';
    return false;
}
document.getElementById('link_js').onclick = function() {
    location.href = '../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api_js/index.html';
    return false;
}
document.getElementById('link_wiki').onclick = function() {
    location.href = '../../Referencia.html';
    return false;
}
}

</script>
 </body>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>

