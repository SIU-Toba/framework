<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
 <title>Referencia/Objetos/datos_tabla - SIU-Toba - Trac</title><link rel="start" href="../../../wiki.html" /><link rel="search" href="../../../../../external.html?link=https://localhost/trac/toba/search" /><link rel="help" href="../../TracGuide.html" /><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css" /><link rel="icon" href="../../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="../../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="alternate" href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/Objetos/datos_tabla?format=txt" title="Plain Text" type="text/plain" /><style type="text/css">
.wikipage h2 {border-bottom: 1px solid gray;}

/* trac php syntax highlighting */
.code-block {
    line-height: 1em;
    font-family: Courier, monotype;
    font-size: 12px;
    }
.h_question { color: #0000BB; } /* highlight.default */
.hphp_commentline { color: #FF8000; } /* highlight.comment */
.hphp_operator { color: #007700; } /* highlight.keyword */
.hphp_word { color: #007700; } /* highlight.keyword */
.hphp_default {}
.hphp_variable { color: #0000BB; } /* highlight.default */
.hphp_hstring { color: #DD0000; } /* highlight.string */
.hphp_simplestring { color: #DD0000; } /* highlight.string */
.h_tagunknown {}
.h_default {}

.code-keyword { color: #007700; font-weight: normal; }
.code-lang { color: #0000BB; font-weight: normal; }
.code-comment { color: #FF8000; font-weight: normal;}
.code-string { color: #DD0000; font-weight: normal;}
</style>
 <script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
</head>

			<body>
			<table border='0' cellspacing='0' cellpadding='0' height='48' width='100%'>
			  <tr>
			
				<td class='header-top-left'><img src='../../../../../../api/media/logo.png' border='0'/></td>
			    <td class='header-top-right'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../../api/media/wiki.png' />
			    	<a href='../../../../../../api/index.html'  title='Navegar hacia la documentación PHP'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../../api/media/php-small.png' /></a> 
			    	<a href='../../../../../../api_js/index.html'  title='Navegar hacia la documentación Javascript'>    		
			    	<img border='0' style='vertical-align: middle' src='../../../../../../api/media/javascript-small.png' /></a>
			  </tr>
			
			  <tr>
			    <td colspan='2' class='header-menu'>
			  		  [ <a href='http://desarrollos2.siu.edu.ar/trac/toba/wiki/Referencia/Objetos/datos_tabla' title='El sitio online contiene contenidos mas detallados y actualizados'
						class='menu'>Ver online</a> ]
			    </td>
			
			  </tr>
			  <tr><td colspan='2' class='header-line'><img src='../../../../../../api/media/empty.png' width='1' height='1' border='0' alt=''  /></td></tr>
			</table>
		


<div id="banner">

<div id="header"><a id="logo" href="../../../../../external.html?link=https://localhost/trac/toba"><img src="../../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a><hr /></div>

<form id="search" action="../../../../../external.html?link=https://localhost/trac/toba/search" method="get">
 
</form>



<div id="metanav" class="nav"><ul><li class="first"><a href="../../../../../external.html?link=https://localhost/trac/toba/login">Login</a></li><li><a href="../../../../../external.html?link=https://localhost/trac/toba/settings">Settings</a></li><li><a href="../../TracGuide.html" accesskey="6">Help/Guide</a></li><li class="last"><a href="../../../../../external.html?link=https://localhost/trac/toba/about">About Trac</a></li></ul></div>
</div>

<div id="mainnav" class="nav"><ul><li class="active first last"><a href="../../../wiki.html" accesskey="1">Wiki</a></li></ul></div>
<div id="main">




<div id="ctxtnav" class="nav">
 <h2>Wiki Navigation</h2>
 <ul>
  <li><a href="../../../wiki.html">Start Page</a></li>
  <li><a href="../../TitleIndex.html">Title Index</a></li>
  <li><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/RecentChanges">Recent Changes</a></li>
  
   <li class="last"><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/Objetos/datos_tabla?action=history">Page History</a></li>
  
 </ul>
 <hr />
</div>

<div id="content" class="wiki">

 
  
  
   <div class="wikipage">
    <div id="searchable"><p>
<a href="../../WikiStart.html">Inicio</a> / <a href="../../Referencia.html">Referencia</a> / <a href="../Objetos.html">Objetos</a> / datos_tabla
</p>
<h1 id="Objetodatos_tabla">Objeto datos_tabla</h1>
<p>
Mantiene una estructura tabular (o también llamada <a class="wiki" href="../../API/RecordSet.html">RecordSet</a>) y brinda una interface para trabajar con ella.
Sus principales características son:
</p>
<ul><li>Utiliza un <a class="wiki" href="AP.html">administrador de persistencia</a> para obtener los datos con un medio de persistencia.
</li><li>Una vez en memoria existen <a class="wiki" href="datos_tabla.html#primitivas">Primitivas</a> para trabajar sobre estos datos.
</li><li>Los datos y sus modificaciones son mantenidos automáticamente en sesión entre los distintos pedidos de página. Esto quiere decir que cuando se pide modificar un dato esta modificación se retiene hasta el final de la <a class="wiki" href="../MarcoTransaccional.html">transacción de negocios</a>.
</li><li>Una vez terminada la edición se hace la sincronización con el medio de persistencia a través del <a class="wiki" href="AP.html">administrador de persistencia</a>, marcando el final de la transacción de negocios.
</li></ul><h2 id="Definición">Definición</h2>
<ul><li>Tabla: Nombre físico de la tabla en la base de datos
</li><li>Tipo de persistencia: <a class="wiki" href="AP.html">administrador de persistencia</a> que se utilizará, optativamente se puede personalizar alguno a manera de subclase.
</li><li>Permitir modificar claves: Por defecto las claves definidas no son modificables.
</li></ul><h2 id="Primitivas">Primitivas</h2>
<p>
La mejor forma de entender las primitivas es revisando el <strong><a href='../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api/Objetos/Persistencia/objeto_datos_tabla.html#' target='_blank'>API</a></strong>, a continuación se dan ejemplos a manera de resumen de las primitivas más utilizadas:
</p>
<h3 id="Carga">Carga</h3>
<p>
Generalmente la carga y sincronización son dos procesos que la tabla no maneja en forma aislada sino que es sólo un participante más de la <a class="wiki" href="datos_relacion.html">relación</a> a la que pertenece. En caso de que la operación maneje una tabla aislada (como pueden ser los ABMs de tablas simples) la carga generalmente se hace restringiendo por valores específicos de campos:
</p>
<pre class="wiki">$tabla-&gt;cargar(array('id' =&gt; 8)); 
</pre>
<h3 id="Trabajoconunúnicoregistro">Trabajo con un único registro</h3>
<p>
La operación puede trabajar con un conjunto masivo de filas o registros, o simplemente con un solo. Este último caso es el más sencillo, asumiendo que la carga anterior siempre asegura un único registro (con <i>id 8</i>), para consultar su contenido se ejecuta:
</p>
<pre class="wiki">$datos = $tabla-&gt;get();
ei_arbol($datos);
</pre>
<p>
Por ejemplo el usuario puede modificar el contenido de la fila y pedir posteriormente la modificación en la tabla:
</p>
<pre class="wiki">$datos['nombre'] = &#34;Nuevo nombre&#34;;
$tabla-&gt;set($datos);
</pre>
<h3 id="Trabajoconvariosregistros">Trabajo con varios registros</h3>
<p>
Las primitivas permiten:
</p>
<ul><li>Consultar los datos de una fila <tt>$tabla-&gt;get_fila($id_fila);</tt>
</li><li>Consultar los datos de varias filas <tt>$tabla-&gt;get_filas($condiciones, true)</tt>
</li><li>Crear una nueva fila: <tt>$tabla-&gt;nueva_fila($datos);</tt>
</li><li>Modificar una fila: <tt>$tabla-&gt;modificar_fila($id_fila, $datos);</tt>
</li><li>Eliminar una fila: <tt>$tabla-&gt;eliminar_fila($id_fila);</tt>
</li><li>Procesar cambios masivos sobre filas <tt>$tabla-&gt;procesar_filas($cambios);</tt> donde $cambios es una matriz asociativa de filas la clave de cada fila es el $id_fila y cada una tiene una columna especial referenciada por la constante <tt>apex_ei_analisis_fila</tt> que marca el proceso a aplicar a la fila por ejemplo:
<pre class="wiki">$cambios = array(
		1001 =&gt; array(apex_ei_analisis_fila =&gt; 'M', 'nombre' =&gt; 'Es una modificación'),
		1010 =&gt; array(apex_ei_analisis_fila =&gt; 'A', 'nombre' =&gt; 'Es una alta'),
		1011 =&gt; array(apex_ei_analisis_fila =&gt; 'B')
	);
</pre>
</li></ul><p>
En todos los casos cuando se habla de $id_fila es la identificación propia de la fila <strong>no relacionada</strong> con la clave de la tabla física.
</p>
<h3 id="Sincronización">Sincronización</h3>
<p>
Al finalizar el trabajo en memoria se pide sincronizar con el medio de persistencia 
</p>
<pre class="wiki">$tabla-&gt;sincronizar();
</pre>
<p>
La sincronización construye los comandos SQL necesarios (updates o inserts) dependiendo de siel registro es nuevo o es sólo una modificación de la carga y los ejecuta dentro de una transacción.
</p>
<h3 id="Eliminación">Eliminación</h3>
<p>
Para eliminar <strong>TODAS</strong> las filas <strong>cargadas</strong> de una tabla se pueden optar por dos caminos:
</p>
<ul><li>Hacerlo a través del <strong>trabajo en memoria</strong> más <strong>sincronización</strong>:
<pre class="wiki">$tabla-&gt;eliminar_filas();
$tabla-&gt;sincronizar();
</pre>
</li></ul><p>
Esta opción es útil cuando las filas a eliminar se encuentran cargadas en memoria.
</p>
<ul><li>Hacerlo a través de una primitiva de eliminación masiva, esta primitiva elimina directamente desde el mecanismo de persistencia
<pre class="wiki">$tabla-&gt;eliminar_todo()
</pre>
</li></ul><p>
Esta opción es útil cuando las filas no están cargadas, sino que se borra utilizando una opción externa, sin ver el contenido de las filas.
</p>
<p>
Nota: Recordar que este estos son los pasos para la carga y sincronización de una tabla aislada, el proceso cambia cuando la tabla está involucrada en un <a class="wiki" href="datos_relacion.html">objeto relación</a>.
Se recomienda ver más información acerca de estas primitivas en la <strong><a href='../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api/Objetos/Persistencia/objeto_datos_tabla.html#' target='_blank'>documentación del API</a></strong>
</p>
<h2 id="Cargadecamposcosméticos">Carga de campos 'cosméticos'</h2>
<p>
Dentro de la transacción es probable que los contenidos de la tabla quieran ser presentados de una forma amigable al usuario. Así por ejemplo las claves foráneas tienen que mostrar su descripción y no su valor, para esto hay dos opciones:
</p>
<ul><li>Agrego el campo 'descripcion' a la tabla y lo marco como externo. De esta forma su valor estará disponible pero no participará de la sincronización.
</li><li>En el ci relleno los datos haciendo la consulta manualmente cada vez que se pide esta información.
</li></ul><p>
El caso recomendado es el primero en donde se agrega el campo en la definición datos_tabla y se lo marca como externo. Además se tiene que brindar una forma de cargar este campo, ya sea a través de un SQL o a través de la invocación de un método PHP.
</p>
<p>
Por ejemplo en el proyecto Referencia, ítem <tt>Operaciones Simples -&gt; ABM de Personas</tt>, en la pantalla de deportes se quieren listar las descripciones del mismo. Entonces se agregan los campos que describen el deporte y el día de semana:
</p>
<p>
<a href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_definicion.html" style="padding:0; border:none"><img src="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_definicion41f0.png?format=raw" alt="Definición de campos externos" title="Definición de campos externos" /></a>
</p>
<p>
Luego es necesario definir una subclase para el administrador de persistencia de esa tabla:
</p>
<p>
<a href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_subclase.html" style="padding:0; border:none"><img src="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_subclase41f0.png?format=raw" alt="Creando una subclase para el persistidor de la tabla" title="Creando una subclase para el persistidor de la tabla" /></a>
</p>
<p>
Finalmente en esta subclase se especifica cómo se cargan estos campos:
</p>
<div class="code"><pre><span class="code-lang">&lt;?
</span><span class="code-keyword">require_once(</span><span class="code-string">"nucleo/persistencia/ap_tabla_db_s.php"</span><span class="code-keyword">);

class </span><span class="code-lang">ap_persona_deportes </span><span class="code-keyword">extends </span><span class="code-lang">ap_tabla_db_s
</span><span class="code-keyword">{
    function </span><span class="code-lang">inicializar</span><span class="code-keyword">()
    {
        </span><span class="code-comment">/*
            Carga la columna externa 'desc_deporte' base a un SQL
            utilizando como parametro la columna 'deporte'
        */
        </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">activar_proceso_carga_externa_sql</span><span class="code-keyword">(
                            </span><span class="code-string">"SELECT nombre FROM ref_deportes WHERE id = '%deporte%';"</span><span class="code-keyword">,
                            array(</span><span class="code-string">'deporte'</span><span class="code-keyword">),
                            array(array(</span><span class="code-string">'origen'</span><span class="code-keyword">=&gt;</span><span class="code-string">'nombre'</span><span class="code-keyword">,
                                        </span><span class="code-string">'destino'</span><span class="code-keyword">=&gt;</span><span class="code-string">'desc_deporte'</span><span class="code-keyword">)),
                            </span><span class="code-lang">true </span><span class="code-keyword">);
        </span><span class="code-comment">/*
            Carga la columna externa 'desc_dia_semana' en base a un METODO
            utilizando como parametro la columna 'dia_semana'
        */
        </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">activar_proceso_carga_externa_dao</span><span class="code-keyword">(</span><span class="code-string">"get_dia_semana"</span><span class="code-keyword">,
                            </span><span class="code-string">"consultas"</span><span class="code-keyword">,
                            </span><span class="code-string">"operaciones_simples/consultas.php"</span><span class="code-keyword">,
                            array(</span><span class="code-string">'dia_semana'</span><span class="code-keyword">),
                            array(</span><span class="code-string">'desc_dia_semana'</span><span class="code-keyword">),
                            </span><span class="code-lang">true </span><span class="code-keyword">);
    }
}
</span><span class="code-lang">?&gt;
</span></span>
</pre></div><h2 id="Másinfo">Más info</h2>
<ul><li>Ejemplo en el <a class="wiki" href="../../Proyectos/Referencia.html">proyecto Referencia</a>, ítems bajo la rama "Operaciones Simples"
</li><li><a class="wiki" href="Persistencia.html">Introducción a los objetos de persistencia</a>.
</li><li><strong><a href='../../../../../external.html?link=https://localhost/toba_editor_trunk/doc/api/Objetos/Persistencia/objeto_datos_tabla.html#' target='_blank'>API del datos tabla</a></strong>
</li></ul></div>
   </div>
   
    <h3 id="tkt-changes-hdr">Attachments</h3>
    <ul class="tkt-chg-list"><li class="tkt-chg-change"><a href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_definicion.html">externos_definicion.png</a> (1.3 kB) -<q>Definición de campos externos</q>, added by seba on 06/01/06 10:47:05.</li><li class="tkt-chg-change"><a href="../../../attachment/wiki/Referencia/Objetos/datos_tabla/externos_subclase.html">externos_subclase.png</a> (4.6 kB) -<q>Creando una subclase para el persistidor de la tabla</q>, added by seba on 06/01/06 10:47:44.</li>
    </ul>
  
  
  <script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"));
  </script>
 
 
</div>

<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="../../../../../external.html?link=https://localhost/trac/toba/wiki/Referencia/Objetos/datos_tabla?format=txt">Plain Text</a></li></ul></div>

</div>

<div id="footer">
 <hr />
 <a id="tracpowered" href="../../../../../external.html?link=http://trac.edgewall.com/"><img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107"
   alt="Trac Powered"/></a>
 <p class="left">
  Powered by <a href="../../../../../external.html?link=https://localhost/trac/toba/about"><strong>Trac 0.9.5</strong></a><br />
  By <a href="../../../../../external.html?link=http://www.edgewall.com/">Edgewall Software</a>.
 </p>
 <p class="right">
  Creado por el SIU<br /><a href="../../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a>
 </p>
</div>



 </body>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>

