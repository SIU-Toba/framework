<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
 <title>Versiones/Migracion1.0.0 - SIU-Toba - Trac</title><link rel="start" href="../../wiki.html" /><link rel="search" href="../../../../external.html?link=https://localhost/trac/toba/search" /><link rel="help" href="../TracGuide.html" /><link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="icon" href="../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="../../../../external.html?link=https://localhost/favicon.ico" type="image/x-icon" /><link rel="alternate" href="../../../../external.html?link=https://localhost/trac/toba/wiki/Versiones/Migracion1.0.0?format=txt" title="Plain Text" type="text/x-trac-wiki" /><style type="text/css">
.wikipage h2 {border-bottom: 1px solid gray;}

/* trac php syntax highlighting */
.code-block {
    line-height: 1em;
    font-family: Courier, monotype;
    font-size: 12px;
    }
.h_question { color: #0000BB; } /* highlight.default */
.hphp_commentline { color: #FF8000; } /* highlight.comment */
.hphp_operator { color: #007700; } /* highlight.keyword */
.hphp_word { color: #007700; } /* highlight.keyword */
.hphp_default {}
.hphp_variable { color: #0000BB; } /* highlight.default */
.hphp_hstring { color: #DD0000; } /* highlight.string */
.hphp_simplestring { color: #DD0000; } /* highlight.string */
.h_tagunknown {}
.h_default {}

.code-keyword { color: #007700; font-weight: normal; }
.code-lang { color: #0000BB; font-weight: normal; }
.code-comment { color: #FF8000; font-weight: normal;}
.code-string { color: #DD0000; font-weight: normal;}

pre { padding:0; margin: 0}

.tablas-screenshots td:first-child { background-color: #D5CECD; width: 30%}
.tablas-screenshots table { width: 90%; border: 1px solid gray; }
.tablas-screenshots td { }
.tablas-screenshots table.wiki td { border: 1px solid gray; }

#tkt-changes-hdr {
    clear: both;
    padding-top: 30px;
}
.wiki-toc {
    clear: right;
    min-width: 160px;
    background-color:#F7F7F7;    
    border: 1px solid #D7D7D7;
}
.wiki-toc .active {
    background-color: #890C71;
    padding: 1px;
}
.wiki-toc .active a {
    color:white; 
}
.wiki-toc .active a:hover {
    background-color:  #890C71;
}
.indice-general {
/*    background-color: #FFFFDD;*/
}
.wikipage h1 {
    padding-top: 5px;
}
.wikipage h2 {
 padding: 2px;
}
.wikipage h1 {
    font-size: 28px;
}
.wikipage h2 {
    background-color: #890C71;
    color: white;
    padding-left: 10px;
    margin-top: 30px;
    font-size: 100%;
    border: 1px solid gray;
}
.wikipage h3 {
    font-size:100%;
}
li {
    margin-bottom:4px;
}
li * {
    margin-bottom:0;
}
/*a {
 color: #890C71;
}*/
@media print {
 .wiki-toc { display: none }
}
#tkt-changes-hdr, .tkt-chg-list { 
    font-size:80%;
    text-align:right;
}

</style>
 <script type="text/javascript" src="../../chrome/common/js/trac.js"></script>
</head>

			<body>
			<table border='0' cellspacing='0' cellpadding='0' height='48' width='100%'>
			  <tr>
			
				<td class='header-top-left'><img src='../../../../../api/media/logo.png' border='0'/></td>
			    <td class='header-top-right'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../api/media/wiki.png' />
			    	<a href='../../../../../api/index.html'  title='Navegar hacia la documentación PHP'>
			    		<img border='0' style='vertical-align: middle' src='../../../../../api/media/php-small.png' /></a> 
			    	<a href='../../../../../api_js/index.html'  title='Navegar hacia la documentación Javascript'>    		
			    	<img border='0' style='vertical-align: middle' src='../../../../../api/media/javascript-small.png' /></a>
			  </tr>
			
			  <tr>
			    <td colspan='2' class='header-menu'>
			  		  [ <a href='http://desarrollos.siu.edu.ar/trac/toba/wiki/Versiones/Migracion1.0' title='El sitio online contiene contenidos mas detallados y actualizados'
						class='menu'>Ver online</a> ]
			    </td>
			
			  </tr>
			  <tr><td colspan='2' class='header-line'><img src='../../../../../api/media/empty.png' width='1' height='1' border='0' alt=''  /></td></tr>
			</table>
		


<div id="banner">

<div id="header"><a id="logo" href="../../../../external.html?link=https://localhost/trac/toba"><img src="../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a><hr /></div>

<form id="search" action="../../../../external.html?link=https://localhost/trac/toba/search" method="get">
 <div>
  <label for="proj-search">Search:</label>
  <input type="text" id="proj-search" name="q" size="10" accesskey="f" value="" />
  <input type="submit" value="Search" />
  <input type="hidden" name="wiki" value="on" />
  <input type="hidden" name="changeset" value="on" />
  <input type="hidden" name="ticket" value="on" />
 </div>
</form>



<div id="metanav" class="nav"><ul><li class="first"><a href="../../../../external.html?link=https://localhost/trac/toba/login">Login</a></li><li><a href="../../../../external.html?link=https://localhost/trac/toba/settings">Settings</a></li><li><a accesskey="6" href="../TracGuide.html">Help/Guide</a></li><li class="last"><a href="../../../../external.html?link=https://localhost/trac/toba/about">About Trac</a></li></ul></div>
</div>

<div id="mainnav" class="nav"><ul><li class="active first"><a accesskey="1" href="../../wiki.html">Wiki</a></li><li><a accesskey="2" href="../../../../external.html?link=https://localhost/trac/toba/timeline">Timeline</a></li><li><a href="../../../../external.html?link=https://localhost/trac/toba/browser">Browse Source</a></li><li class="last"><a accesskey="4" href="../../../../external.html?link=https://localhost/trac/toba/search">Search</a></li></ul></div>
<div id="main">




<div id="ctxtnav" class="nav">
 <h2>Wiki Navigation</h2>
 <ul>
   <li><a href="../../wiki.html">Start Page</a></li>
   <li><a href="../TitleIndex.html">Index by Title</a></li>
   <li><a href="../../../../external.html?link=https://localhost/trac/toba/wiki/RecentChanges">Index by Date</a></li>
   <li class="last"><a href="../../../../external.html?link=https://localhost/trac/toba/wiki/Versiones/Migracion1.0.0?action=diff&amp;version=21">Last Change</a></li>
 </ul>
 <hr />
</div>

<div id="content" class="wiki">

 
  
  
   
   <div class="wikipage">
    <div id="searchable"><h1 id="InstruccionesdeMigraciónhacialaversión1.0">Instrucciones de Migración hacia la versión 1.0</h1>
<h2 id="Pasosdelamigración">Pasos de la migración</h2>
<ol><li>Actualizar a una versión de php 5.1.x, para tener acceso a las <a class="ext-link" href="../../../../external.html?link=http://www.php.net/pdo"><span class="icon">extensiones PDO</span></a>, ya que se utiliza en reemplazo de <a class="missing wiki" href="../AdoDb.html" rel="nofollow">AdoDb?</a> (es posible seguir usando <a class="missing wiki" href="../AdoDb.html" rel="nofollow">AdoDb?</a> pero no se distribuye más con el framework).
</li><li>Seguir los pasos de <a class="wiki" href="../Versiones.html">migración típicos</a>
</li><li>Instalar un nuevo item de login al proyecto:
<pre class="wiki">toba proyecto actualizar_login -p mi_proyecto
</pre></li></ol><h2 id="Cambiosqueefectuaelmigradorautomático">Cambios que efectua el migrador automático</h2>
<h3 id="Metadatos">Metadatos</h3>
<ul><li>Normaliza los parámetros de los efs deserializandolos y moviendolos a campos de la tabla de efs.
</li><li>Los parametros del combo lista cambiaron, para brindar mayor ortogonalidad a la definición. Ahora los valores en la lista se separan siempre por coma y los clave-valor (si clave != valor) se separan por <tt>/</tt>.
</li><li>Los parametros de inicializacion de la ventana pasan de ser 3 e implicitos a n y explicitos, asi se pueden definir cualquiera y ademas pueden ser modificados como los parametros de los eventos.
</li><li>Las clases de combo se unificaron en una única.
</li><li>El ef_editable_multilinea pasa a ser ef_editable_textarea.
</li><li>El ef_clave tiene un parámetro <tt>edit_confirmar_clave=1</tt> por defecto.
</li><li>La clase css lista-col-titulo del cuadro paso a ser ei-cuadro-col-tit.
</li><li>Los estilos de los botones de los eventos cambiaron (abm-input-eliminar a ei-boton-baja, abm-input a ei-boton)
</li><li>Cambios en tipo de pagina de los items. Se eliminan 'com_js', 'consumidor_html' y 'lista_admin'. 'popup' pasa a ser 'ef_popup'.
</li><li>Se eliminan los objetos de la arquitectura vieja (transversales) y sus vinculos entrantes y salientes.
</li><li>Se elimina la solicitud_browser, se migran a solicitud_web
</li><li>Se pone NULL en la fuente de datos de aquellos objetos que no les dan uso.
</li></ul><p>
 
</p>
<h3 id="Código">Código</h3>
<ul><li>Migra los paths en las referencias a archivos del nucleo, por ejemplo en los include o require.
</li><li>Migración de api:
<ul><li><tt>evt__id__carga</tt> por <tt>conf__id</tt>
</li><li><tt>evt__entrada__id</tt> por <tt>evt__id__entrada</tt>
</li><li><tt>evt__salida__id</tt> por <tt>evt__id__salida</tt>.
</li><li><tt>evt__inicializar</tt> por ini.
</li><li><tt>objeto_X</tt> pasa a ser <tt>toba_X</tt> (ej toba_ei_formulario).
</li><li><tt>nucleo_toba</tt> pasa a ser <tt>toba_nucleo</tt>.
</li><li>Al uso de las clases del nucleo se les agrega el prefijo <tt>toba_</tt>.
</li><li>Los shorcuts <tt>toba::get_X()</tt> se pasan a <tt>toba::X()</tt>.
</li><li>La <tt>cola_mensajes</tt> pasa a ser <tt>notificacion</tt>.
</li><li>Varios <tt>obtener_html</tt> se pasan a <tt>generar_html</tt>
</li><li>Varios <tt>obtener_X</tt> se pasan a <tt>get_X</tt>
</li><li>El hilo pasa a llamarse memoria.
</li><li>Varios métodos que se consumian como <tt>toba::hilo()-&gt;</tt> pasan a <tt>toba::proyecto()</tt>, <tt>toba::usuario()</tt>, etc
</li></ul></li></ul><p>
   
</p>
<h2 id="Cambiosquerequierenmigraciónmanual">Cambios que requieren migración manual</h2>
<h3 id="Cambiosgenerales">Cambios generales</h3>
<ul><li>Aquellos items utilizados para salidas no-html (como sacar un pdf, un excel, etc.), deberían utilizar la <a class="wiki" href="../Referencia/Solicitud.html#SolicituddeAcci%C3%B3nPHP">solicitud_accion</a> y no la web.
</li></ul><h3 id="Cambiosgeneralesdenomenclatura">Cambios generales de nomenclatura</h3>
<ul><li>Para cambiar el estado de algo usar set_ (salvo que sea un proceso complejo y que tenga en sí mismo un nombre, por ejemplo 'registrar_tal_cosa'
</li><li>Para obtener el estado usar get_. Los booleanos creo que pueden ser una buena excepcion, es mas representativo preguntar es_par() que get_par()
</li><li>Cuando algo genera html con echos llamarlo generar_
</li><li>Cuando retorna html llamarlo get_
</li></ul><h3 id="CambiosaAPIdelhilo">Cambios a API del hilo</h3>
<ul><li>El método <tt>obtener_proyecto_path_www</tt> pasa a llamarse <tt>toba::proyecto()-&gt;get_www()</tt> 
</li><li>El método <tt>obtener_path_temp_www</tt> paao a llamarse <tt>toba::proyecto()-&gt;get_www_temp()</tt>
</li><li>Ambos metodos retornan un array asociativo con claves <tt>path</tt> y <tt>url</tt> (en lugar de <tt>browser</tt> y <tt>real</tt> como era antes). Ej 
<pre class="wiki">array('path' =&gt; 'c:\\proyecto\\www\\temp', 'url' =&gt; '/proyecto/temp')
</pre></li></ul><h3 id="CambiosdeAPIacomponentes">Cambios de API a componentes</h3>
<ul><li>'obtener_botones_*' pasa a ser 'generar_botones_*'
</li><li>'consumo_javascript_global' pasa a ser 'get_consumo_javascript'
</li><li>El metodo anterior <tt>configuracion</tt> del objeto se elimina.
</li><li>agregar_evento, set_eventos y set_evento_defecto se eliminan (estaban deprecated desde 0.8.3)
</li><li>Como norma general, aquellos metodos que hacen <tt>echo</tt> empiezan con <tt>generar</tt> y no <tt>obtener</tt>. Todos los obtener_html se movieron a generar_html. 
</li><li>En javascript las funciones globales <tt>formatCurrency</tt>, <tt>es_igual</tt> y <tt>redondear</tt> se incluyen en una clase estatica <tt>financiero</tt>.
</li></ul><h3 id="CambiodeAPIacis">Cambio de API a cis</h3>
<ul><li>get_etapa_inicial (obsoleto desde 0.8.3) se elimina (usar get_pantalla_inicial)
</li><li><tt>evt__pre_cargar_datos_dependencias</tt> y  <tt>evt__post_cargar_datos_dependencias</tt> se eliminan.
</li><li>set_etapa_gi y get_etapa_gi pasan a ser set_pantalla() y get_id_pantalla()
</li><li>No hay mas metodos con la palabra 'etapa' son todas 'pantalla'
</li><li>El paginado del cuadro a cargo del CI no se hace mas con el evento <tt>cant_reg</tt> sino configurandolo explicitamente con el metodo del cuadro <tt>set_total_registros</tt>.
</li><li>En javascript <tt>this._ci</tt> paso a ser <tt>this.controlador</tt>
</li></ul><h3 id="CambiodeAPIenlosformulariosyfiltros">Cambio de API en los formularios y filtros</h3>
<ul><li>Los métodos establecer_* y obtener_* de los formularios y filtros pasan a ser set_* y get_*, excepto:
<ul><li><i>obtener_nombres_ef</i> pasa a ser <i>get_nombres_ef</i> y no retorna el id en html (que ahora cambio porque no puede empezar con numero segun los estandar) sino el id en el Toba.
</li></ul></li><li><tt>deshabilitar_efs</tt> se elimina (queda set_solo_lectura y desactivar_efs).
</li><li><tt>ejecutar_metodo_ef</tt> se elimina, usar ef('tal')-&gt;metodo()
</li><li>En el ML 'cantidad_lineas' pasa a 'get_cantidad_lineas'
</li><li>En el ML el evento <tt>pedido_registro_nuevo</tt> no usa el retorno como fila template, se debe usar el metodo del ML <tt>set_registro_nuevo</tt> para incluir (o no) una fila nueva, por defecto se incluye una vacía.
</li><li>En el ML <tt>existen_datos_cargados</tt> pasa a ser <tt>datos_cargados</tt> (igual al ei_cuadro).
</li></ul><h3 id="CambiosdeAPIdelosefs">Cambios de API de los efs</h3>
<ul><li>Los métodos establecer_* y obtener_* de los efs pasan a ser set_* y get_*, excepto:
<ul><li><i>establecer_id_form</i> pasa a ser <i>ir_a_fila</i> (igual que su par en js).
</li><li><i>establecer_lectura</i> fue eliminado (siempre es lectura!), usar set_solo_lectura(false);
</li><li><i>establecer_no_obligatorio</i> fue eliminado, utilizar set_obligatorio(false);
</li><li><i>obtener_info</i> fue eliminado.
</li><li><i>cargar_estado</i> se divide en dos: <i>set_estado($estado)</i> y <i>cargar_estado_post</i> 
</li></ul></li><li>En js:
<ul><li><tt>set_valores</tt> pasa a ser <tt>set_opciones</tt>
</li><li><tt>cambiar_valor y valor</tt> pasan a ser <tt>set_estado y get_estado</tt>, aunque siguen disponibles (en un futuro es probable que se saquen).
</li><li><tt>id()</tt> pasa a ser <tt>get_id</tt>
</li><li><tt>valor_formateado</tt> pasa a ser <tt>get_estado_con_formato</tt>
</li></ul></li><li>En php <tt>activado</tt> pasa a ser <tt>tiene_estado</tt> (activado-desactivado se confunde con habilitado-deshabilitado)
</li></ul><h3 id="Efpopup">Ef popup</h3>
<p>
El ef_popup con carga de descripción con SQL cambia la forma de parametrización. Anteriormente era necesario indicar con %w% el where y con el parámetro columna_clave la columna clave. Además el retorno era clave-valor. Por ejemplo:
</p>
<pre class="wiki">SELECT clave,valor FROM tabla %w%
</pre><p>
Se cambio a la forma general de incidir en el SQL, la misma que usa la cascada, además es inecesario retornar el estado (la clave) porque ya se conoce. Entonces quedaría así
</p>
<pre class="wiki">SELECT valor FROM tabla WHERE clave='%id_ef_actual%'
</pre><h3 id="Efcheckbox">Ef checkbox</h3>
<p>
El valor seteado se asume en '1'  y el no seteado en '0'.
</p>
<h3 id="Efeditable">Ef editable</h3>
<ul><li>El parametro 'estilo' se elimina, usar selectores css.
</li><li>El parametro tamano por defecto se fija en 10 (teniendo en cuenta la puntuacion daria un maximo de 9.999.999 o 999.999,99). El anterior era 5 y en general es muy poco.
</li></ul><h3 id="Estilosdeimpresion">Estilos de impresion</h3>
<p>
El estilo de una etiqueta en vista_impresion pasa a ser <tt>ef-etiqueta</tt> (el mismo usado en el html comun) en lugar de <tt>lista-col-titulo</tt> (que se usa para cuadros).
</p>
<h3 id="Inicializaciondelcontextodelproyecto">Inicializacion del contexto del proyecto</h3>
<p>
El codigo de inicializacion que se ubicaba en el archivo <strong>inicializacion.php</strong> se traslada a la ventana <tt>conf__inicial</tt> de la clase <strong>toba_contexto_ejecucion</strong>. Si el proyecto utilizaba esta funcionalidad, debe extender esta clase del nucleo (crear una clase que implemente la interface <strong>toba_interface_contexto_ejecucion</strong> y definir la extension desde el editor) y trasladar el codigo del archivo a la ventana especificada.
</p>
<h3 id="CambiodeAPIdelasfuentesdedatos">Cambio de API de las fuentes de datos</h3>
<ul><li>La función <tt>ejecutar_sql</tt> pasa a ser <tt>ejecutar_fuente</tt> (para hacerle similar a <tt>consultar_fuente</tt>)
</li><li>
</li><li>Estas funciones globales se eliminaron
<pre class="wiki">	function abrir_base($id,$parm)
	function abrir_fuente_datos($id, $proyecto=null)
	function existe_conexion($id)
	function obtener_fuente($id, $ado=null)
	function recuperar_datos($sql, $fuente="instancia", $ado=null)
	function recuperar_secuencia($secuencia, $fuente="instancia")
</pre></li><li>De la clase toba_db se elimina <tt>ejecutar_sql</tt> (usar <tt>ejecutar</tt> a secas)
</li><li><tt>ejecutar_transaccion</tt> no retorna más un arreglo con el mensaje de exito
</li><li>La fuente por defecto se define en las propiedades básicas del proyecto, y no se asume <tt>instancia</tt>
</li><li>Constantes de tipo de fetch:
<pre class="wiki">	define('apex_db_asociativo', ADODB_FETCH_ASSOC);
	define('apex_db_numerico', ADODB_FETCH_NUM);
				
	define('toba_db_fetch_asoc', PDO::FETCH_ASSOC);
	define('toba_db_fetch_num', PDO::FETCH_NUM);
</pre></li></ul></div>
   </div>
   
  
  <script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
 
 
</div>

<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="../../../../external.html?link=https://localhost/trac/toba/wiki/Versiones/Migracion1.0.0?format=txt">Plain Text</a></li></ul></div>

</div>

<div id="footer">
 <hr />
 <a id="tracpowered" href="../../../../external.html?link=http://trac.edgewall.org/"><img src="../../chrome/common/trac_logo_mini.png" height="30" width="107"
   alt="Trac Powered"/></a>
 <p class="left">
  Powered by <a href="../../../../external.html?link=https://localhost/trac/toba/about"><strong>Trac 0.10.3</strong></a><br />
  By <a href="../../../../external.html?link=http://www.edgewall.org/">Edgewall Software</a>.
 </p>
 <p class="right">
  Creado por el SIU<br /><a href="../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a>
 </p>
</div>



 </body>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>

