<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
 <title>Referencia/Objetos/Persistencia - SIU-Toba - Trac</title><link rel="start" href="../../../wiki.html" /><link rel="search" href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/search" /><link rel="help" href="../../TracGuide.html" /><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css" /><link rel="icon" href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/favicon.ico" type="image/x-icon" /><link rel="alternate" href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/Referencia/Objetos/Persistencia?format=txt" title="Plain Text" type="text/plain" /><style type="text/css">
</style>
 <script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
</head>
<body>


<div id="banner">

<div id="header"><a id="logo" href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba"><img src="../../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a><hr /></div>

<form id="search" action="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/search" method="get">
 <div>
  <label for="proj-search">Search:</label>
  <input type="text" id="proj-search" name="q" size="10" accesskey="f" value="" />
  <input type="submit" value="Search" />
  <input type="hidden" name="wiki" value="on" />
  <input type="hidden" name="changeset" value="on" />
  <input type="hidden" name="ticket" value="on" />
 </div>
</form>



<div id="metanav" class="nav"><ul><li class="first"><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/login">Login</a></li><li><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/settings">Settings</a></li><li><a href="../../TracGuide.html" accesskey="6">Help/Guide</a></li><li class="last"><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/about" accesskey="9">About Trac</a></li></ul></div>
</div>

<div id="mainnav" class="nav"><ul><li class="active first"><a href="../../../wiki.html" accesskey="1">Wiki</a></li><li><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/timeline" accesskey="2">Timeline</a></li><li><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/roadmap" accesskey="3">Roadmap</a></li><li><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/browser">Browse Source</a></li><li><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/report">View Tickets</a></li><li class="last"><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/search" accesskey="4">Search</a></li></ul></div>
<div id="main">




<div id="ctxtnav" class="nav">
 <h2>Wiki Navigation</h2>
 <ul>
  <li><a href="../../../wiki.html">Start Page</a></li>
  <li><a href="../../TitleIndex.html">Title Index</a></li>
  <li><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/RecentChanges">Recent Changes</a></li>
  
   <li class="last"><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/Referencia/Objetos/Persistencia?action=history">Page History</a></li>
  
 </ul>
 <hr />
</div>

<div id="content" class="wiki">

 
  
  
   <div class="wikipage">
    <div id="searchable"><p>
<a href="../../WikiStart.html">Inicio</a> / <a href="../../Referencia.html">Referencia</a> / <a href="../Objetos.html">Objetos</a> / Persistencia
</p>
<h1 id="Introducciónalosobjetosdepersistencia">Introducción a los objetos de persistencia</h1>
<p>
Los objetos de persistencia tienen como objetivo resolver una problematica bien puntual: ayudar al controlador de interface en el progreso del <a class="wiki" href="../MarcoTransaccional.html">Marco Transaccional</a>. Esto es cargar un conjunto de datos relacionados, mantener los <i>cambios</i> a estos datos en memoria y finalmente sincronizarlos con el medio de persistencia cuando sea solicitado.
</p>
<h2 id="Porqué">¿Porqué?</h2>
<p>
Cuando los datos a manejar son simples, es fácil mantener la información en el CI, cuando los datos empiezan a ser complejos, fruto del manejo de relaciones en la base de datos, es muy tedioso tener que mantener estas estructuras en forma manual. La solución a este problema es describir en forma de objeto toba a las tablas y relaciones que se van a manipular en la transacción. 
</p>
<p>
La solución que brindan estos objetos son:
</p>
<ul><li>Guardar el estado de los datos que manejan, el CI sólo tendrá que guardar en sesión información relacionada con la presentación pero ya no más los datos de la operación.
</li><li>Brindar una API de manipulación de datos orientada a datos tabulares.
</li><li>El mecanismo de carga y sincronización es manejado por una clase aparte llamada <i>Administrador de persistencia</i>, es la que en definiva forma las query de carga y los comandos update, insert y delete para el caso de una base de datos relacional.
</li></ul><p>
 
</p>
<h2 id="ComportamientoGeneral">Comportamiento General</h2>
<h3 id="Duranteladefinición">Durante la definición</h3>
<ul><li>Se modelan datos tabulares, generalmente tablas de una BD relacional. El objeto utilizado es el <a class="wiki" href="datos_tabla.html">objeto_datos_tabla</a>.
</li><li>Se modelan las relaciones entre estas tabla (utilizando el objeto <a class="wiki" href="datos_relacion.html">objeto_datos_relacion</a>).
</li><li>Se asigna la relación al CI encargado de la transacción.
</li></ul><p>
<a href="../../../attachment/wiki/Referencia/Objetos/Persistencia/intro_persistencia.png" style="padding:0; border:none"><img src="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/attachment/wiki/Referencia/Objetos/Persistencia/intro_persistencia.png?format=raw"  style="" /></a>
</p>
<h3 id="Durantelaejecución">Durante la ejecución</h3>
<p>
Siempre desde el CI encargado de la transacción:
</p>
<ul><li>Se carga el datos_relacion como <i>dependencia del CI</i> (no es la carga de datos), a diferencia de otros objetos esta carga no es automática, sólo se hace cuando se necesita. Como esta carga se debe una sola vez por pedido de página, cuando algún elemento necesite dialogar con el datos_relacion se recomienda definir un método que la primera vez que se llama carga la dependencia y luego la retorna ya cargada:
<div class="code"><pre><span class="code-lang">&lt;?php

    </span><span class="code-comment">/**
    *    Retorna el datos_relacion de esta operación
    */
    </span><span class="code-keyword">function </span><span class="code-lang">get_relacion</span><span class="code-keyword">()
    {
        if (! isset(</span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'relacion'</span><span class="code-keyword">])) {
            </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">cargar_dependencia</span><span class="code-keyword">(</span><span class="code-string">'relacion'</span><span class="code-keyword">);
        }
        return </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'relacion'</span><span class="code-keyword">];
    }
</span><span class="code-lang">?&gt;
</span></span>
</pre></div></li></ul><p>
<strong>ATENCION:</strong>: Esto se debería hacer automáticamente, en la nueva versión tiene que haber un método $this-&gt;dependencia($nombre) que la primera vez la cargue y luego la utilize.
</p>
<ul><li>Se <strong>cargan datos</strong> en la relación con una restricción (generalmente la clave de la tabla principal que se está editando), en caso del alta de un nuevo registro se resetea la relación (por si estaba cargada con algún dato previamente). Generalmente la condición de alta o modificación de un conjunto de datos se tiene antes de llegar a este punto (generalmente desde un CI de nivel superior que da la posibilidad al usuario de crear una entidad nueva o editar una existente), por lo que se utilizan dos atributos del objeto <i>es_nuevo</i> e <i>id_editado</i>.
<div class="code"><pre><span class="code-lang">&lt;?php

    </span><span class="code-comment">/**
    *    Retorna el datos_relacion de esta operación
    */
    </span><span class="code-keyword">function </span><span class="code-lang">get_relacion</span><span class="code-keyword">()
    {
        if (! isset(</span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'relacion'</span><span class="code-keyword">])) {
            </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">cargar_dependencia</span><span class="code-keyword">(</span><span class="code-string">'relacion'</span><span class="code-keyword">);
        }
        if (</span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">es_nuevo</span><span class="code-keyword">) {
            </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'relacion'</span><span class="code-keyword">]-&gt;</span><span class="code-lang">resetear</span><span class="code-keyword">();
            </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">es_nuevo </span><span class="code-keyword">= </span><span class="code-lang">false</span><span class="code-keyword">;
        }
        if (isset(</span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">id_editado</span><span class="code-keyword">)) {
            </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'relacion'</span><span class="code-keyword">]-&gt;</span><span class="code-lang">cargar</span><span class="code-keyword">(</span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">id_editado</span><span class="code-keyword">);
            unset(</span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">id_editado</span><span class="code-keyword">);
        }
        return </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'relacion'</span><span class="code-keyword">];
    }
</span><span class="code-lang">?&gt;
</span></span>
</pre></div></li></ul><ul><li>Los eventos de los distintos elementos de interface (eis) son ruteados hacia el datos_tabla correspondiente. Por ejemplo el carga de un formulario se alimenta del datos_tabla que contiene los datos que se quieren manipular, lo mismo sucede cuando se produce la modificación. El siguiente ejemplo <strong>trabaja con un solo registro</strong> por eso la simplicidad de la llamada:
<div class="code"><pre><span class="code-lang">&lt;?php
    </span><span class="code-keyword">function </span><span class="code-lang">evt__aula__carga</span><span class="code-keyword">()
    {
        return </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">get_relacion</span><span class="code-keyword">()-&gt;</span><span class="code-lang">tabla</span><span class="code-keyword">(</span><span class="code-string">'aula'</span><span class="code-keyword">)-&gt;</span><span class="code-lang">get</span><span class="code-keyword">();
    }
    
    function </span><span class="code-lang">evt__aula__modificacion</span><span class="code-keyword">(</span><span class="code-lang">$datos</span><span class="code-keyword">)
    {
        </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">get_relacion</span><span class="code-keyword">()-&gt;</span><span class="code-lang">tabla</span><span class="code-keyword">(</span><span class="code-string">'aula'</span><span class="code-keyword">)-&gt;</span><span class="code-lang">set</span><span class="code-keyword">(</span><span class="code-lang">$datos</span><span class="code-keyword">);
    }
</span><span class="code-lang">?&gt;
</span></span>
</pre></div></li><li>Cuando el CI quiere finalizar la transacción (por ejemplo el usuario decide guardar), se pide sincronizar el datos_relacion.
<div class="code"><pre><span class="code-lang">&lt;?php
    </span><span class="code-keyword">function </span><span class="code-lang">evt__guardar</span><span class="code-keyword">()
    {
        </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">get_relacion</span><span class="code-keyword">()-&gt;</span><span class="code-lang">sincronizar</span><span class="code-keyword">();
    }
</span><span class="code-lang">?&gt;
</span></span>
</pre></div></li></ul><p>
Estos son los pasos para escenarios sencillos, para más información sobre los servicios que brindan estos objetos se encuentra en:
</p>
<ul><li><a class="wiki" href="datos_relacion.html">objeto_datos_relacion</a>
</li><li><a class="wiki" href="datos_tabla.html">objeto_datos_tabla</a>
</li></ul></div>
   </div>
   
    <h3 id="tkt-changes-hdr">Attachments</h3>
    <ul class="tkt-chg-list"><li class="tkt-chg-change"><a href="../../../attachment/wiki/Referencia/Objetos/Persistencia/intro_persistencia.png">intro_persistencia.png</a> (5.0 kB) - added by seba on 11/14/05 13:08:23.</li>
    </ul>
  
  
  <script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"));
  </script>
 
 
</div>

<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/Referencia/Objetos/Persistencia?format=txt">Plain Text</a></li></ul></div>

</div>

<div id="footer">
 <hr />
 <a id="tracpowered" href="../../../../../external.html?link=http://trac.edgewall.com/"><img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107"
   alt="Trac Powered"/></a>
 <p class="left">
  Powered by <a href="../../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/about"><strong>Trac 0.9.2</strong></a><br />
  By <a href="../../../../../external.html?link=http://www.edgewall.com/">Edgewall Software</a>.
 </p>
 <p class="right">
  Creado por el Programa SIU<br /><a href="../../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a>
 </p>
</div>



 </body>
</html>

