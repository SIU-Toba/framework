<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
 <title>Versiones/0.8.1 - SIU-Toba - Trac</title><link rel="start" href="../../wiki.html" /><link rel="search" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/search" /><link rel="help" href="../TracGuide.html" /><link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="icon" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/favicon.ico" type="image/x-icon" /><link rel="alternate" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/Versiones/0.8.1?format=txt" title="Plain Text" type="text/plain" /><style type="text/css">
.wikipage h2 {border-bottom: 1px solid gray;}
</style>
 <script type="text/javascript" src="../../chrome/common/js/trac.js"></script>
</head>
<body>


<div id="banner">

<div id="header"><a id="logo" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba"><img src="../../chrome/site/logo_toba_siu.gif" width="282" height="90" alt="Toba" /></a><hr /></div>

<form id="search" action="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/search" method="get">
 <div>
  <label for="proj-search">Search:</label>
  <input type="text" id="proj-search" name="q" size="10" accesskey="f" value="" />
  <input type="submit" value="Search" />
  <input type="hidden" name="wiki" value="on" />
  <input type="hidden" name="changeset" value="on" />
  <input type="hidden" name="ticket" value="on" />
 </div>
</form>



<div id="metanav" class="nav"><ul><li class="first"><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/login">Login</a></li><li><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/settings">Settings</a></li><li><a href="../TracGuide.html" accesskey="6">Help/Guide</a></li><li class="last"><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/about" accesskey="9">About Trac</a></li></ul></div>
</div>

<div id="mainnav" class="nav"><ul><li class="active first"><a href="../../wiki.html" accesskey="1">Wiki</a></li><li><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/timeline" accesskey="2">Timeline</a></li><li><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/roadmap" accesskey="3">Roadmap</a></li><li><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/browser">Browse Source</a></li><li><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/report">View Tickets</a></li><li class="last"><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/search" accesskey="4">Search</a></li></ul></div>
<div id="main">




<div id="ctxtnav" class="nav">
 <h2>Wiki Navigation</h2>
 <ul>
  <li><a href="../../wiki.html">Start Page</a></li>
  <li><a href="../TitleIndex.html">Title Index</a></li>
  <li><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/RecentChanges">Recent Changes</a></li>
  
   <li class="last"><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/Versiones/0.8.1?action=history">Page History</a></li>
  
 </ul>
 <hr />
</div>

<div id="content" class="wiki">

 
  
  
   <div class="wikipage">
    <div id="searchable"><p>
<a href="../WikiStart.html">Inicio</a> / <a href="../Versiones.html">Versiones</a> / 0.8.1
</p>
<h1 id="Toba0.8.1">Toba 0.8.1</h1>
<ul><li>Fecha: 23 de Mayo del 2005
</li><li>Fuente: <a class="source" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/browser/tags/0.8.1">source:tags/0.8.1</a>
</li><li>Revisiones involucradas: <a class="changeset" title="Solución al ticket #1: Nuevo esquema de notificación validación. Se ..." href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/changeset/306">[306]</a> a <a class="changeset" title="Creado en base a [322]. Terminación milestone:0.8.1" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/changeset/323">[323]</a>.
</li><li>Progreso de la versión: <a class="milestone" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/milestone/0.8.1">milestone:0.8.1</a>
</li><li><a class="wiki" href="Migracion0.8.html">Instructivo de migración</a>.
</li><li>Nombre clave: <strong>Archon</strong>.
</li></ul><p>
Los cambios fueron elegidos en base a prioridades de ComII.
 
</p>
<h2 id="Colapsadodeelementos">Colapsado de elementos</h2>
<p>
Tanto los controladores como los elementos de interface tienen capacidad de colapsarse gráficamente. Un elemento puede iniciar colapsado, teniendo el usuario la posibilidad de cambiar esta propiedad en ejecución.<br /><br />
Formas de habilitar el colapsado:
</p>
<ul><li>Desde el administrador: Dentro de la propiedades básicas del objeto, atributo <i>Colapsable</i>.
</li><li>En ejecución: Invocando al método <i>colapsar</i> del objeto. Por ejemplo dentro de un CI si se quiere colapsar un filtro:
<div class="code"><pre> <span class="code-lang">&lt;?php
     $this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'id_del_filtro'</span><span class="code-keyword">]-&gt;</span><span class="code-lang">colapsar</span><span class="code-keyword">(); 
 </span><span class="code-lang">?&gt;
</span></span>
</pre></div></li></ul><p>
 
Esta funcionalidad requiere que el objeto tenga título (el usuario debe entender que es lo que se va a mostrar/ocultar).
 
</p>
<h2 id="EventosyBotones">Eventos y Botones</h2>
<p>
Previamente el concepto de evento y botón estaban ligados. En esta versión un evento puede tener opcionalmente un botón asociado, esta elección se marca con el atributo <i>en_botonera</i> del evento. Por otro lado un evento puede especificarse <i>por_defecto</i> y se va a disparar cuando el usuario no invoca alguno explícitamente. Un ejemplo clásico es un formulario sin botones que siempre dispara el evento <i>modificacion</i>. Por ejemplo para cambiar el evento por defecto de un formulario desde el CI:
</p>
<div class="code"><pre><span class="code-lang">&lt;?php
    $this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'id_de_formulario'</span><span class="code-keyword">]-&gt;</span><span class="code-lang">set_evento_defecto</span><span class="code-keyword">(</span><span class="code-string">'modificacion'</span><span class="code-keyword">);
</span><span class="code-lang">?&gt;
</span></span>
</pre></div><p>
<br />
Para facilitar la creación de nuevos eventos se provee una clase <a class="source" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/browser/trunk/php/nucleo/browser/clases/eventos.php">eventos</a>. Esta clase tiene estas responsabilidades:
</p>
<ul><li>Es un repositorio de eventos predefinidos (cancelar, alta, etc.).
</li><li>Puede clonar estos eventos en otros para personalizarlos.
</li><li>Permite construir un evento con propiedades básicas.
</li><li>Traslada la definición del evento desde PHP a JS.
</li></ul><p>
 
Por ejemplo para agregar un evento <i>cancelar</i> a un cuadro desde un CI, conservando los eventos predefinidos:
</p>
<div class="code"><pre><span class="code-lang">&lt;?php
    $eventos </span><span class="code-keyword">= </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'id_del_cuadro'</span><span class="code-keyword">]-&gt;</span><span class="code-lang">get_lista_eventos</span><span class="code-keyword">();
    </span><span class="code-lang">$eventos </span><span class="code-keyword">+= </span><span class="code-lang">eventos</span><span class="code-keyword">::</span><span class="code-lang">cancelar</span><span class="code-keyword">();
    </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'id_del_cuadro'</span><span class="code-keyword">]-&gt;</span><span class="code-lang">set_eventos</span><span class="code-keyword">(</span><span class="code-lang">$eventos</span><span class="code-keyword">);
</span><span class="code-lang">?&gt;
</span></span>
</pre></div><p>
Por defecto este evento se incluiría en la botonera del objeto, si en cambio se quiere hacer oculto para, por ejemplo, disparar el evento solamente desde javascript:
</p>
<div class="code"><pre><span class="code-lang">&lt;?php
    $evento</span><span class="code-keyword">[</span><span class="code-string">'cancelar'</span><span class="code-keyword">][</span><span class="code-string">'en_botonera'</span><span class="code-keyword">] = </span><span class="code-lang">false</span><span class="code-keyword">;
</span><span class="code-lang">?&gt;
</span></span>
</pre></div><p>
Otra opción es duplicar un evento existente, por ejemplo se toma el evento <i>seleccion</i> del cuadro y se lo duplica para hacer un evento <i> </i>selección para borrar<i>:
</i></p>
<div class="code"><pre><span class="code-lang">&lt;?php
    $borra </span><span class="code-keyword">= </span><span class="code-lang">eventos</span><span class="code-keyword">::</span><span class="code-lang">duplicar</span><span class="code-keyword">(</span><span class="code-lang">eventos</span><span class="code-keyword">::</span><span class="code-lang">seleccion</span><span class="code-keyword">(), </span><span class="code-string">'seleccion_borrar'</span><span class="code-keyword">);
    </span><span class="code-lang">$borra</span><span class="code-keyword">[</span><span class="code-string">'seleccion_borrar'</span><span class="code-keyword">][</span><span class="code-string">'imagen'</span><span class="code-keyword">] = </span><span class="code-lang">recurso</span><span class="code-keyword">::</span><span class="code-lang">imagen_apl</span><span class="code-keyword">(</span><span class="code-string">'borrar.gif'</span><span class="code-keyword">);
    </span><span class="code-lang">$borra</span><span class="code-keyword">[</span><span class="code-string">'seleccion_borrar'</span><span class="code-keyword">][</span><span class="code-string">'confirmacion'</span><span class="code-keyword">] = </span><span class="code-string">'¿Está seguro que quiere borrar la fila?'</span><span class="code-keyword">;
    </span><span class="code-lang">$borra</span><span class="code-keyword">[</span><span class="code-string">'seleccion_borrar'</span><span class="code-keyword">][</span><span class="code-string">'ayuda'</span><span class="code-keyword">] = </span><span class="code-string">'Borra la fila'</span><span class="code-keyword">;
</span><span class="code-lang">?&gt;
</span></span>
</pre></div><h2 id="Notificaciones">Notificaciones</h2>
<p>
Se integra la cola de mensajes del server con la de javascript terminando por ahora en un alert. Está la opción de utilizar una ventana modal DHTML, pero como es un cambio gráfico grande se dejó pendiente.<br />
Desde un objeto en PHP la forma de hacer una notificación es:
</p>
<div class="code"><pre><span class="code-lang">&lt;?php
    $this</span><span class="code-keyword">-&gt;</span><span class="code-lang">informar_msg</span><span class="code-keyword">(</span><span class="code-string">"Este es un error"</span><span class="code-keyword">, </span><span class="code-string">'error'</span><span class="code-keyword">);
</span><span class="code-lang">?&gt;
</span></span>
</pre></div><p>
En javascript, directamente se utiliza la cola de mensajes:
</p>
<div class="code"><pre>cola_mensajes.agregar(<B><span class="code-string">&quot;Este es un error&quot;</span></B>);
</pre></div><h2 id="Modificacionesalei_cuadro">Modificaciones al ei_cuadro</h2>
<p>
Dependiendo de la definición en el administrador, los ei_cuadro tienen los siguientes eventos:
</p>
<ul><li>seleccion: Incluye una lupa al costado del registro como medio de disparo. El parámetro del evento es la clave de la fila. La selección deja al cuadro en un estado <i>seleccionado</i> cambiando el fondo de la fila seleccionada. Para que esto funcione correctamente los eventos que dejan sin efecto esta selección deben notificar al cuadro. Por ejemplo, cuando un formulario cancela, deselecciona el cuadro:
<div class="code"><pre><span class="code-lang">&lt;?php
    </span><span class="code-keyword">function </span><span class="code-lang">evt__formulario___cancelar</span><span class="code-keyword">()
    {
        </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">dependencias</span><span class="code-keyword">[</span><span class="code-string">'cuadro'</span><span class="code-keyword">]-&gt;</span><span class="code-lang">deseleccionar</span><span class="code-keyword">();    
    }    
</span><span class="code-lang">?&gt;
</span></span>
</pre></div></li><li>ordenamiento: Incluye las flechas de ordenamiento, tiene como parámetros la columna y el sentido del ordenamiento. Por ejemplo:
<div class="code"><pre><span class="code-lang">&lt;?php
    </span><span class="code-keyword">function </span><span class="code-lang">evt__cuadro__ordenar</span><span class="code-keyword">(</span><span class="code-lang">$param</span><span class="code-keyword">)
    {
        </span><span class="code-lang">$columna </span><span class="code-keyword">= </span><span class="code-lang">$param</span><span class="code-keyword">[</span><span class="code-string">'columna'</span><span class="code-keyword">];
        </span><span class="code-lang">$sentido </span><span class="code-keyword">= </span><span class="code-lang">$param</span><span class="code-keyword">[</span><span class="code-string">'sentido'</span><span class="code-keyword">];
        </span><span class="code-lang">$this</span><span class="code-keyword">-&gt;</span><span class="code-lang">informar_msg</span><span class="code-keyword">(</span><span class="code-string">"Se quiere ordenar la columna $columna en orden $sentido"</span><span class="code-keyword">, </span><span class="code-string">'info'</span><span class="code-keyword">);
    }
</span><span class="code-lang">?&gt;
</span></span>
</pre></div></li></ul><p>
Estas columnas del cuadro pueden marcarse desde el administrador como <i>total</i>. Esto sumariza automáticamente y aplica el formato de la columna.<br />
A nivel implementación el <a class="missing wiki" href="../objeto_ei_cuadro.html" rel="nofollow">ei_cuadro?</a> deja de heredar de <a class="missing wiki" href="../objeto_cuadro.html" rel="nofollow">objeto_cuadro?</a>. 
</p>
<h2 id="ValidacióndeFormulariosenJavascript">Validación de Formularios en Javascript</h2>
<p>
Es posible extender la validación en forma global de un formulario en javascript escuchando el evento <i>validar</i> de la siguiente forma:
</p>
<div class="code"><pre><span class="code-lang">&lt;?php
    </span><span class="code-keyword">function </span><span class="code-lang">extender_objeto_js</span><span class="code-keyword">()
    {
        </span><span class="code-comment">//Requiere que alguna de las filas del ML tenga definido un valor para el 'importe'
        </span><span class="code-keyword">echo </span><span class="code-string">"
            {$this-&gt;objeto_js}.evt__validar_datos = function() {
                var filas = this.filas();
                var hay_uno = false;
                for (fila in filas) {
                    var importe = this.ef('importe').ir_a_fila(filas[fila]).valor();
                    if (importe &gt; 0 || importe &lt; 0)
                        hay_uno = true;
                }
                if (! hay_uno) {
                    cola_mensajes.agregar('Debe ingresar al menos un importe.');
                    return false;
                } else {
                    return true;
                }
            }
        "</span><span class="code-keyword">;
    }
</span><span class="code-lang">?&gt;
</span></span>
</pre></div><h2 id="SolucióndeBugs">Solución de Bugs</h2>
<ul><li><a class="closed ticket" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/ticket/83" title="Manejo de mensajes predefinidos (closed)">#83</a> Mensajes predefinidos 
</li><li><a class="closed ticket" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/ticket/77" title="Confirmacion en Javascript (closed)">#77</a> Confirmaciones en JS
</li><li><a class="closed ticket" href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/ticket/78" title="Bug en IE (closed)">#78</a> Bug en el submit del CI-js 
</li></ul></div>
   </div>
   
  
  <script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"));
  </script>
 
 
</div>

<script type="text/javascript">searchHighlight()</script>
<div id="altlinks"><h3>Download in other formats:</h3><ul><li class="first last"><a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/wiki/Versiones/0.8.1?format=txt">Plain Text</a></li></ul></div>

</div>

<div id="footer">
 <hr />
 <a id="tracpowered" href="../../../../external.html?link=http://trac.edgewall.com/"><img src="../../chrome/common/trac_logo_mini.png" height="30" width="107"
   alt="Trac Powered"/></a>
 <p class="left">
  Powered by <a href="../../../../external.html?link=https://desarrollos2.siu.edu.ar/trac/toba/about"><strong>Trac 0.9.2</strong></a><br />
  By <a href="../../../../external.html?link=http://www.edgewall.com/">Edgewall Software</a>.
 </p>
 <p class="right">
  Creado por el Programa SIU<br /><a href="../../../../external.html?link=http://www.siu.edu.ar/">http://www.siu.edu.ar</a>
 </p>
</div>



 </body>
</html>

